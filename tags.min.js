var b="is-active",c=["is-active","bg-primary","text-white"],f="data-value",m=new WeakMap,p=class{constructor(e,t={}){e.style.display="none",m.set(e,this),this.t=e;let s=l=>["true","false","1","0",!0,!1].includes(l)&&!!JSON.parse(l),i={...t,...e.dataset};for(this.allowNew=i.allowNew?s(i.allowNew):!1,this.showAllSuggestions=i.showAllSuggestions?s(i.showAllSuggestions):!1,this.badgeStyle=i.badgeStyle||"primary",this.allowClear=i.allowClear?s(i.allowClear):!1,this.clearEnd=i.clearEnd?s(i.clearEnd):!1,this.server=i.server||!1,this.liveServer=i.liveServer?s(i.liveServer):!1,this.serverParams=i.serverParams||{},typeof this.serverParams=="string"&&(this.serverParams=JSON.parse(this.serverParams)),this.selected=i.selected?i.selected.split(","):[],this.suggestionsThreshold=typeof i.suggestionsThreshold<"u"?parseInt(i.suggestionsThreshold):1,this.validationRegex=i.regex||"",this.separator=i.separator?i.separator.split("|"):[],this.max=i.max?parseInt(i.max):null,this.clearLabel=i.clearLabel||"Clear",this.searchLabel=i.searchLabel||"Type a value",this.valueField=i.valueField||"value",this.labelField=i.labelField||"label",this.keepOpen=i.keepOpen?s(i.keepOpen):!1,this.fullWidth=i.fullWidth?s(i.fullWidth):!1,this.debounceTime=i.debounceTime?parseInt(i.debounceTime):300,this.baseClass=i.baseClass||"",this.placeholder=i.placeholder||this.g(),this.h=!1,this.n=!0,this.S=p.debounce(()=>{this.p(!0)},this.debounceTime),this.o=[],this.overflowParent=null,this.parentForm=e.parentElement;this.parentForm&&(this.parentForm.style.overflow==="hidden"&&(this.overflowParent=this.parentForm),this.parentForm=this.parentForm.parentElement,!(this.parentForm&&this.parentForm.nodeName=="FORM")););this.reset=this.reset.bind(this),this.parentForm&&this.parentForm.addEventListener("reset",this.reset),this.i=document.createElement("div"),this.a=document.createElement("div"),this.s=document.createElement("ul"),this.e=document.createElement("input"),this.i.appendChild(this.a),this.a.appendChild(this.e),this.i.appendChild(this.s),this.t.parentNode.insertBefore(this.i,this.t.nextSibling),this.w(),this.L(),this.A(),this.C(),this.resetState(),this.server&&!this.liveServer?this.p():this.resetSuggestions()}static init(e="select[multiple]",t={}){let s=document.querySelectorAll(e);for(let i=0;i<s.length;i++)p.getInstance(s[i])||new p(s[i],t)}static getInstance(e){if(m.has(e))return m.get(e)}static debounce(e,t=300){let s;return(...i)=>{clearTimeout(s),s=setTimeout(()=>{e.apply(this,i)},t)}}dispose(){m.delete(this.t),this.t.style.display="block",this.i.parentNode.removeChild(this.i),this.parentForm&&this.parentForm.removeEventListener("reset",this.reset)}resetState(){this.isDisabled()?(this.i.setAttribute("readonly",""),this.e.setAttribute("disabled","")):(this.i.hasAttribute("readonly")&&this.i.removeAttribute("readonly"),this.e.hasAttribute("disabled")&&this.e.removeAttribute("disabled"))}resetSuggestions(){let e=Array.from(this.t.querySelectorAll("option")).filter(t=>!t.disabled).map(t=>({value:t.getAttribute("value"),label:t.textContent}));this.m(e)}p(e=!1){this.d&&this.d.abort(),this.d=new AbortController,this.serverParams.query=this.e.value;let t=new URLSearchParams(this.serverParams).toString();fetch(this.server+"?"+t,{signal:this.d.signal}).then(s=>s.json()).then(s=>{let i=s.data||s;this.m(i),this.d=null,e?this.c():this.l()}).catch(s=>{s.name!=="AbortError"&&console.error(s)})}g(){if(this.t.hasAttribute("placeholder"))return this.t.getAttribute("placeholder");if(this.t.dataset.placeholder)return this.t.dataset.placeholder;let e=this.t.querySelector("option");return e?(e.hasAttribute("selected")&&e.removeAttribute("selected"),e.value?"":e.textContent):""}L(){this.s.classList.add("dropdown-menu","p-0"),this.s.style.maxHeight="280px",this.fullWidth||(this.s.style.maxWidth="360px"),this.s.style.overflowY="auto",this.s.addEventListener("mouseenter",e=>{this.h=!1})}w(){this.i.classList.add("form-control","dropdown"),this.t.classList.contains("form-select-lg")&&this.i.classList.add("form-control-lg"),this.t.classList.contains("form-select-sm")&&this.i.classList.add("form-control-sm"),this.overflowParent&&(this.i.style.position="inherit"),this.v()===4&&(this.i.style.height="auto")}A(){this.a.addEventListener("click",t=>{this.isDisabled()||this.e.style.visibility!="hidden"&&this.e.focus()});let e=this.t.selectedOptions;for(let t=0;t<e.length;t++){let s=e[t];!s.value||(this.o.push(s),this.addItem(s.textContent,s.value))}}C(){this.e.type="text",this.e.autocomplete="off",this.e.spellcheck=!1,this.e.style.backgroundColor="transparent",this.e.style.border=0,this.e.style.outline=0,this.e.style.maxWidth="100%",this.e.ariaLabel=this.searchLabel,this.f(!0),this.e.addEventListener("input",e=>{if(e.data){let t=e.data.slice(-1);if(this.separator.length&&this.e.value&&this.separator.includes(t)){this.e.value=this.e.value.slice(0,-1);let s=this.e.value;this.u(s,null);return}}this.r(),this.e.value.length>=this.suggestionsThreshold?this.b():this.l()}),this.e.addEventListener("focus",e=>{this.e.value.length>=this.suggestionsThreshold&&this.b()}),this.e.addEventListener("focusout",e=>{this.l(),this.keepOpen&&this.f()}),this.e.addEventListener("keydown",e=>{switch(e.keyCode||e.key){case 13:case"Enter":e.preventDefault();let s=this.getActiveSelection();if(s)s.click();else if(this.allowNew&&this.e.value){let l=this.e.value;this.u(l,null)}break;case 38:case"ArrowUp":e.preventDefault(),this.h=!0;let i=this.E();this.e.value.length==0&&this.s.classList.contains("show")&&!i&&this.l();break;case 40:case"ArrowDown":e.preventDefault(),this.h=!0,this.x(),this.e.value.length==0&&!this.s.classList.contains("show")&&this.c();break;case 8:case"Backspace":this.e.value.length==0&&(this.removeLastItem(),this.r(),this.l());break;case 27:case"Escape":this.l();break}})}u(e,t=null,s={}){!this.canAdd(e,t)||(this.addItem(e,t,s),this.keepOpen?this.c():this.f())}E(){let e=this.getActiveSelection();if(e){let t=e.parentNode;do t=t.previousSibling;while(t&&t.style.display=="none");return t?(e.classList.remove(...c),t.querySelector("a").classList.add(...c),t.parentNode.scrollTop=t.offsetTop-t.parentNode.offsetTop,t):null}return null}x(){let e=this.getActiveSelection(),t=null;if(e){t=e.parentNode;do t=t.nextSibling;while(t&&t.style.display=="none");return t?(e.classList.remove(...c),t.querySelector("a").classList.add(...c),t.offsetTop>t.parentNode.offsetHeight-t.offsetHeight&&(t.parentNode.scrollTop+=t.offsetHeight),t):null}return t}k(e,t=null){var s=document.createElement("span");document.body.appendChild(s),s.style.fontSize=t||"inherit",s.style.height="auto",s.style.width="auto",s.style.position="absolute",s.style.whiteSpace="no-wrap",s.innerHTML=e;let i=Math.ceil(s.clientWidth)+8;return document.body.removeChild(s),i}r(){this.e.value?this.e.size=this.e.value.length:this.getSelectedValues().length?(this.e.placeholder="",this.e.size=1):(this.e.size=this.placeholder.length>0?this.placeholder.length:1,this.e.placeholder=this.placeholder);let e=this.e.value||this.e.placeholder,t=window.getComputedStyle(this.i).fontSize,s=this.k(e,t);this.e.style.minWidth=s+"px"}m(e){for(;this.s.lastChild;)this.s.removeChild(this.s.lastChild);for(let t=0;t<e.length;t++){let s=e[t];if(!s[this.valueField])continue;if(!this.liveServer&&(s.selected||this.selected.includes(s[this.valueField]))){this.o.push({value:s[this.valueField],textContent:s[this.labelField],dataset:s.data}),this.u(s[this.labelField],s[this.valueField],s.data);continue}let i=document.createElement("li"),l=document.createElement("a");if(i.append(l),l.classList.add("dropdown-item","text-truncate"),l.setAttribute(f,s[this.valueField]),l.setAttribute("href","#"),l.textContent=s[this.labelField],s.data)for(let[h,r]of Object.entries(s.data))l.dataset[h]=r;this.s.appendChild(i),l.addEventListener("mouseenter",h=>{this.h||(this.removeActiveSelection(),i.querySelector("a").classList.add(...c))}),l.addEventListener("mousemove",h=>{this.h=!1}),l.addEventListener("mousedown",h=>{h.preventDefault()}),l.addEventListener("click",h=>{h.preventDefault(),this.u(l.textContent,l.getAttribute(f),l.dataset)})}}reset(){this.removeAll(),this.n=!1;for(let e=0;e<this.o.length;e++){let t=this.o[e];this.addItem(t.textContent,t.value,t.dataset)}this.r(),this.n=!0}f(e=!1){this.e.value="",this.r(),e||(this.l(),this.e.dispatchEvent(new Event("input"))),this.max&&this.getSelectedValues().length>=this.max?this.e.style.visibility="hidden":this.e.style.visibility=="hidden"&&(this.e.style.visibility="visible"),this.isSingle()&&!e&&document.activeElement.blur()}getSelectedValues(){let e=this.t.querySelectorAll("option[selected]");return Array.from(e).map(t=>t.value)}b(){this.liveServer?this.S():this.c()}c(){if(this.e.style.visibility=="hidden")return;let e=this.e.value.toLocaleLowerCase(),t=this.getSelectedValues(),s=this.s.querySelectorAll("li"),i=!1,l=null,h=!1;for(let r=0;r<s.length;r++){let a=s[r],d=a.textContent.toLocaleLowerCase(),n=a.querySelector("a");if(n.classList.remove(...c),t.indexOf(n.getAttribute(f))!=-1){a.style.display="none";continue}h=!0;let o=e.length===0||d.indexOf(e)!==-1;this.showAllSuggestions||this.suggestionsThreshold===0||o?(a.style.display="list-item",i=!0,!l&&o&&(l=a)):a.style.display="none"}if(l||this.showAllSuggestions?(this.i.classList.remove("is-invalid"),l&&(l.querySelector("a").classList.add(...c),l.parentNode.scrollTop=l.offsetTop)):!this.allowNew&&!(e.length===0&&!h)?this.i.classList.add("is-invalid"):this.validationRegex&&this.isInvalid()&&this.i.classList.remove("is-invalid"),!i||this.isInvalid())this.s.classList.remove("show");else if(this.s.classList.add("show"),this.fullWidth)this.s.style.left=-1+"px",this.s.style.width=this.i.offsetWidth+"px";else{let r=this.e.offsetLeft,a=document.body.offsetWidth-1,d=30,n=a-(r+this.s.offsetWidth)-d;n<0&&(r=r+n),this.s.style.left=r+"px";let o=document.body.offsetHeight,u=this.e.getBoundingClientRect().y+window.pageYOffset+this.s.offsetHeight;o-u<0?this.s.style.transform="translateY(calc(-100% - "+d+"px))":this.s.style.transform="none"}}l(){this.s.classList.remove("show"),this.i.classList.remove("is-invalid"),this.removeActiveSelection()}v(){let e=5;return window.jQuery&&$.fn.tooltip!=null&&$.fn.tooltip.Constructor!=null&&(e=parseInt($.fn.tooltip.Constructor.VERSION.charAt(0))),e}F(e){let t=Array.from(this.t.querySelectorAll("option")).find(s=>s.textContent==e);return!!(t&&t.getAttribute("selected"))}I(e){return new RegExp(this.validationRegex.trim()).test(e)}getActiveSelection(){return this.s.querySelector("a."+b)}removeActiveSelection(){let e=this.getActiveSelection();e&&e.classList.remove(...c)}removeAll(){this.getSelectedValues().forEach(t=>{this.removeItem(t,!0)}),this.r()}removeLastItem(e){let t=this.a.querySelectorAll("span");if(!t.length)return;let s=t[t.length-1];this.removeItem(s.getAttribute(f),e)}isDisabled(){return this.t.hasAttribute("disabled")||this.t.disabled||this.t.hasAttribute("readonly")}isInvalid(){return this.i.classList.contains("is-invalid")}isSingle(){return!this.t.hasAttribute("multiple")}canAdd(e,t=null){return t||(t=e),!e||this.isDisabled()||!this.isSingle()&&this.F(e)||this.max&&this.getSelectedValues().length>=this.max?!1:this.validationRegex&&!this.I(e)?(this.i.classList.add("is-invalid"),!1):!0}addItem(e,t=null,s={}){t||(t=e),this.isSingle()&&this.getSelectedValues().length&&this.removeLastItem(!0);let i=this.v(),l=this.t.querySelector('option[value="'+t+'"]');l&&(s=l.dataset);let h=e,r=document.createElement("span"),a=["badge"],d=this.badgeStyle;if(s.badgeStyle&&(d=s.badgeStyle),s.badgeClass&&a.push(...s.badgeClass.split(" ")),this.baseClass?(i===5?a.push("me-2"):a.push("mr-2"),a.push(...this.baseClass.split(" "))):i===5?a=[...a,"me-2","bg-"+d,"mw-100"]:a=[...a,"mr-2","badge-"+d],r.classList.add(...a),r.setAttribute(f,t),this.allowClear){let n=a.includes("text-dark")?"btn-close":"btn-close-white",o,u;this.clearEnd?(o=i===5?"ms-2":"ml-2",u=i===5?"float-end":"float:right;"):(o=i===5?"me-2":"mr-2",u=i===5?"float-start":"float:left;"),h=(i===5?'<button type="button" style="font-size:0.65em" class="'+o+" "+u+" btn-close "+n+'" aria-label="'+this.clearLabel+'"></button>':'<button type="button" style="font-size:1em;'+u+'text-shadow:none;color:currentColor;transform:scale(1.2)" class="'+o+' close" aria-label="'+this.clearLabel+'"><span aria-hidden="true">&times;</span></button>')+h}if(r.innerHTML=h,this.a.insertBefore(r,this.e),this.allowClear&&r.querySelector("button").addEventListener("click",n=>{n.preventDefault(),n.stopPropagation(),this.isDisabled()||(this.removeItem(t),document.activeElement.blur(),this.r())}),!l){l=document.createElement("option"),l.value=t,l.textContent=e;for(let[n,o]of Object.entries(s))l.dataset[n]=o;this.t.appendChild(l)}l.setAttribute("selected","selected"),l.selected=!0,this.n&&this.t.dispatchEvent(new Event("change",{bubbles:!0}))}removeItem(e,t=!1){let s=this.a.querySelector("span["+f+'="'+e+'"]');if(!s)return;s.remove();let i=this.t.querySelector('option[value="'+e+'"]');i&&(i.removeAttribute("selected"),i.selected=!1,this.n&&!t&&this.t.dispatchEvent(new Event("change",{bubbles:!0}))),this.e.style.visibility=="hidden"&&this.max&&this.getSelectedValues().length<this.max&&(this.e.style.visibility="visible")}},g=p;export{g as default};
//# sourceMappingURL=tags.min.js.map
