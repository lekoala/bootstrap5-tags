var p="is-active",o=["is-active","bg-primary","text-white"],d="data-value",v=new WeakMap,c=class{#o;#t;#i;#l;#s;#e;#a;#r;constructor(e,t={}){e.style.display="none",v.set(e,this),this.#t=e;let s=l=>["true","false","1","0",!0,!1].includes(l)&&!!JSON.parse(l),i={...t,...e.dataset};for(this.allowNew=i.allowNew?s(i.allowNew):!1,this.showAllSuggestions=i.showAllSuggestions?s(i.showAllSuggestions):!1,this.badgeStyle=i.badgeStyle||"primary",this.allowClear=i.allowClear?s(i.allowClear):!1,this.server=i.server||!1,this.liveServer=i.liveServer?s(i.liveServer):!1,this.serverParams=i.serverParams||{},typeof this.serverParams=="string"&&(this.serverParams=JSON.parse(this.serverParams)),this.suggestionsThreshold=typeof i.suggestionsThreshold!="undefined"?parseInt(i.suggestionsThreshold):1,this.validationRegex=i.regex||"",this.separator=i.separator?i.separator.split("|"):[],this.max=i.max?parseInt(i.max):null,this.clearLabel=i.clearLabel||"Clear",this.searchLabel=i.searchLabel||"Type a value",this.placeholder=this.#p(),this.#a=!1,this.#r=!0,this.parentForm=e.parentElement;this.parentForm&&(this.parentForm=this.parentForm.parentElement,!(this.parentForm&&this.parentForm.nodeName=="FORM")););this.reset=this.reset.bind(this),this.parentForm&&this.parentForm.addEventListener("reset",this.reset),this.#i=document.createElement("div"),this.#l=document.createElement("div"),this.#s=document.createElement("ul"),this.#e=document.createElement("input"),this.#i.appendChild(this.#l),this.#l.appendChild(this.#e),this.#i.appendChild(this.#s),this.#t.parentNode.insertBefore(this.#i,this.#t.nextSibling),this.#g(),this.#m(),this.#b(),this.#y(),this.resetState(),this.server&&!this.liveServer?this.#c():this.resetSuggestions()}static init(e="select[multiple]",t={}){let s=document.querySelectorAll(e);for(let i=0;i<s.length;i++)c.getInstance(s[i])||new c(s[i],t)}static getInstance(e){if(v.has(e))return v.get(e)}dispose(){v.delete(this.#t),this.#t.style.display="block",this.#i.parentNode.removeChild(this.#i),this.parentForm&&this.parentForm.removeEventListener("reset",this.reset)}resetState(){this.isDisabled()?(this.#i.setAttribute("readonly",""),this.#e.setAttribute("disabled","")):(this.#i.hasAttribute("readonly")&&this.#i.removeAttribute("readonly"),this.#e.hasAttribute("disabled")&&this.#e.removeAttribute("disabled"))}resetSuggestions(){let e=Array.from(this.#t.querySelectorAll("option")).filter(t=>!t.disabled).map(t=>({value:t.getAttribute("value"),label:t.textContent}));this.#f(e)}#c(e=!1){this.#o&&this.#o.abort(),this.#o=new AbortController,this.serverParams.query=this.#e.value;let t=new URLSearchParams(this.serverParams).toString();fetch(this.server+"?"+t,{signal:this.#o.signal}).then(s=>s.json()).then(s=>{let i=s.data||s;this.#f(i),this.#o=null,e&&this.#u()}).catch(s=>{s.name!=="AbortError"&&console.error(s)})}#p(){if(this.#t.hasAttribute("placeholder"))return this.#t.getAttribute("placeholder");if(this.#t.dataset.placeholder)return this.#t.dataset.placeholder;let e=this.#t.querySelector("option");return e?(e.hasAttribute("selected")&&e.removeAttribute("selected"),e.value?"":e.textContent):""}#m(){this.#s.classList.add("dropdown-menu","p-0"),this.#s.style.maxHeight="280px",this.#s.style.overflowY="auto",this.#s.addEventListener("mouseenter",e=>{this.#a=!1})}#g(){this.#i.classList.add("form-control","dropdown"),this.#v()===4&&(this.#i.style.height="auto")}#b(){this.#l.addEventListener("click",t=>{this.isDisabled()||this.#e.style.visibility!="hidden"&&this.#e.focus()});let e=this.#t.selectedOptions;for(let t=0;t<e.length;t++){let s=e[t];!s.value||(s.dataset.init=1,this.addItem(s.textContent,s.value))}}#y(){this.#e.type="text",this.#e.autocomplete="off",this.#e.spellcheck=!1,this.#e.style.backgroundColor="transparent",this.#e.style.border=0,this.#e.style.outline=0,this.#e.style.maxWidth="100%",this.#e.ariaLabel=this.searchLabel,this.#d(!0),this.#e.addEventListener("input",e=>{if(e.data){let t=e.data.slice(-1);if(this.separator.length&&this.#e.value&&this.separator.includes(t)){this.#e.value=this.#e.value.slice(0,-1);let s=this.#e.value;if(!this.canAdd(s))return;this.addItem(s,null),this.#d();return}}this.#n(),this.#e.value.length>=this.suggestionsThreshold?this.liveServer?this.#c(!0):this.#u():this.#h()}),this.#e.addEventListener("focus",e=>{this.#e.value.length>=this.suggestionsThreshold&&this.#u()}),this.#e.addEventListener("focusout",e=>{this.#h()}),this.#e.addEventListener("keydown",e=>{switch(e.keyCode||e.key){case 13:case"Enter":e.preventDefault();let s=this.getActiveSelection();if(s)s.click();else if(this.allowNew&&this.#e.value){let l=this.#e.value;if(!this.canAdd(l))return;this.addItem(l,null),this.#d()}break;case 38:case"ArrowUp":e.preventDefault(),this.#a=!0;let i=this.#S();this.#e.value.length==0&&this.#s.classList.contains("show")&&!i&&this.#h();break;case 40:case"ArrowDown":e.preventDefault(),this.#a=!0,this.#A(),this.#e.value.length==0&&!this.#s.classList.contains("show")&&this.#u();break;case 8:case"Backspace":this.#e.value.length==0&&(this.removeLastItem(),this.#n(),this.#h());break;case 27:case"Escape":this.#h();break}})}#S(){let e=this.getActiveSelection();if(e){let t=e.parentNode;do t=t.previousSibling;while(t&&t.style.display=="none");return t?(e.classList.remove(...o),t.querySelector("a").classList.add(...o),t.parentNode.scrollTop=t.offsetTop-t.parentNode.offsetTop,t):null}return null}#A(){let e=this.getActiveSelection(),t=null;if(e){t=e.parentNode;do t=t.nextSibling;while(t&&t.style.display=="none");return t?(e.classList.remove(...o),t.querySelector("a").classList.add(...o),t.offsetTop>t.parentNode.offsetHeight-t.offsetHeight&&(t.parentNode.scrollTop+=t.offsetHeight),t):null}return t}#n(){this.#e.value?this.#e.size=this.#e.value.length+1:this.getSelectedValues().length?(this.#e.placeholder="",this.#e.size=1):(this.#e.size=this.placeholder.length>0?this.placeholder.length:1,this.#e.placeholder=this.placeholder)}#f(e=null){for(;this.#s.lastChild;)this.#s.removeChild(this.#s.lastChild);for(let t=0;t<e.length;t++){let s=e[t];if(!s.value)continue;let i=document.createElement("li"),l=document.createElement("a");if(i.append(l),l.classList.add("dropdown-item"),l.setAttribute(d,s.value),l.setAttribute("href","#"),l.textContent=s.label,s.data)for(let[r,a]of Object.entries(s.data))l.dataset[r]=a;this.#s.appendChild(i),l.addEventListener("mouseenter",r=>{this.#a||(this.removeActiveSelection(),i.querySelector("a").classList.add(...o))}),l.addEventListener("mousemove",r=>{this.#a=!1}),l.addEventListener("mousedown",r=>{r.preventDefault()}),l.addEventListener("click",r=>{r.preventDefault();let a=l.textContent;!this.canAdd(a,l.getAttribute(d))||(this.addItem(a,l.getAttribute(d),l.dataset),this.#d())})}}reset(){this.removeAll(),this.#r=!1;let e=this.#t.querySelectorAll("option[data-init]");for(let t=0;t<e.length;t++){let s=e[t];this.addItem(s.textContent,s.value)}this.#n(),this.#r=!0}#d(e=!1){this.#e.value="",this.#n(),e||(this.#h(),this.#e.dispatchEvent(new Event("input"))),this.max&&this.getSelectedValues().length===this.max?this.#e.style.visibility="hidden":this.#e.style.visibility=="hidden"&&(this.#e.style.visibility="visible"),this.isSingle()&&!e&&document.activeElement.blur()}getSelectedValues(){let e=this.#t.querySelectorAll("option[selected]");return Array.from(e).map(t=>t.value)}#u(){if(this.#e.style.visibility=="hidden")return;this.#s.style.left=this.#e.offsetLeft+"px";let e=this.#e.value.toLocaleLowerCase(),t=this.getSelectedValues(),s=this.#s.querySelectorAll("li"),i=!1,l=null,r=!1;for(let a=0;a<s.length;a++){let n=s[a],u=n.textContent.toLocaleLowerCase(),h=n.querySelector("a");if(h.classList.remove(...o),t.indexOf(h.getAttribute(d))!=-1){n.style.display="none";continue}r=!0;let f=e.length===0||u.indexOf(e)!==-1;this.showAllSuggestions||this.suggestionsThreshold===0||f?(n.style.display="list-item",i=!0,!l&&f&&(l=n)):n.style.display="none"}l?(this.#i.classList.remove("is-invalid"),l.querySelector("a").classList.add(...o),l.parentNode.scrollTop=l.offsetTop-l.parentNode.offsetTop):!this.allowNew&&!(e.length===0&&!r)?this.#i.classList.add("is-invalid"):this.validationRegex&&this.isInvalid()&&this.#i.classList.remove("is-invalid"),!i||this.isInvalid()?this.#s.classList.remove("show"):this.#s.classList.add("show")}#h(){this.#s.classList.remove("show"),this.#i.classList.remove("is-invalid"),this.removeActiveSelection()}#v(){let e=5;return window.jQuery&&$.fn.tooltip!=null&&$.fn.tooltip.Constructor!=null&&(e=parseInt($.fn.tooltip.Constructor.VERSION.charAt(0))),e}#w(e){let t=Array.from(this.#t.querySelectorAll("option")).find(s=>s.textContent==e);return!!(t&&t.getAttribute("selected"))}#L(e){return new RegExp(this.validationRegex.trim()).test(e)}getActiveSelection(){return this.#s.querySelector("a."+p)}removeActiveSelection(){let e=this.getActiveSelection();e&&e.classList.remove(...o)}removeAll(){this.getSelectedValues().forEach(t=>{this.removeItem(t)}),this.#n()}removeLastItem(e){e&&(this.#r=!1);let t=this.#l.querySelectorAll("span");if(!t.length)return;let s=t[t.length-1];this.removeItem(s.getAttribute(d)),this.#r=!0}isDisabled(){return this.#t.hasAttribute("disabled")||this.#t.disabled||this.#t.hasAttribute("readonly")}isInvalid(){return this.#i.classList.contains("is-invalid")}isSingle(){return!this.#t.hasAttribute("multiple")}canAdd(e,t=null){return t||(t=e),!e||this.isDisabled()||!this.isSingle()&&this.#w(t)||this.max&&this.getSelectedValues().length>=this.max?!1:this.validationRegex&&!this.#L(e)?(this.#i.classList.add("is-invalid"),!1):!0}addItem(e,t=null,s={}){t||(t=e),this.isSingle()&&this.getSelectedValues().length&&this.removeLastItem(!0);let i=this.#v(),l=this.#t.querySelector('option[value="'+t+'"]');l&&(s=l.dataset);let r=e,a=document.createElement("span"),n=["badge"],u=this.badgeStyle;if(s.badgeStyle&&(u=s.badgeStyle),s.badgeClass&&n.push(s.badgeClass),i===5?n=[...n,"me-2","bg-"+u]:n=[...n,"mr-2","badge-"+u],a.classList.add(...n),a.setAttribute(d,t),this.allowClear&&(r=(i===5?'<button type="button" style="font-size:0.65em" class="me-2 float-start btn-close btn-close-white" aria-label="'+this.clearLabel+'"></button>':'<button type="button" style="font-size:1em;float:left;text-shadow:none;color:currentColor;transform:scale(1.2)" class="mr-2 close" aria-label="'+this.clearLabel+'"><span aria-hidden="true">&times;</span></button>')+r),a.innerHTML=r,this.#l.insertBefore(a,this.#e),this.allowClear&&a.querySelector("button").addEventListener("click",h=>{h.preventDefault(),h.stopPropagation(),this.isDisabled()||(this.removeItem(t),document.activeElement.blur(),this.#n())}),!l){l=document.createElement("option"),l.value=t,l.textContent=e;for(let[h,f]of Object.entries(s))l.dataset[h]=f;this.#t.appendChild(l)}l.setAttribute("selected","selected"),l.selected=!0,this.#r&&this.#t.dispatchEvent(new Event("change",{bubbles:!0}))}removeItem(e){let t=this.#l.querySelector("span["+d+'="'+e+'"]');if(!t)return;t.remove();let s=this.#t.querySelector('option[value="'+e+'"]');s&&(s.removeAttribute("selected"),s.selected=!1,this.#r&&this.#t.dispatchEvent(new Event("change",{bubbles:!0}))),this.#e.style.visibility=="hidden"&&this.max&&this.getSelectedValues().length<this.max&&(this.#e.style.visibility="visible")}},m=c;export{m as default};
//# sourceMappingURL=tags.min.js.map
