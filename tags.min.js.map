{
  "version": 3,
  "sources": ["tags.js"],
  "sourcesContent": ["/**\r\n * Bootstrap 5 (and 4!) tags\r\n * https://github.com/lekoala/bootstrap5-tags\r\n * @license MIT\r\n */\r\n\r\n// #region config\r\n\r\n/**\r\n * @callback EventCallback\r\n * @param {Event} event\r\n * @param {Tags} inst\r\n * @returns {void}\r\n */\r\n\r\n/**\r\n * @callback ServerCallback\r\n * @param {Response} response\r\n * @param {Tags} inst\r\n * @returns {Promise}\r\n */\r\n\r\n/**\r\n * @callback ErrorCallback\r\n * @param {Error} e\r\n * @param {AbortSignal} signal\r\n * @param {Tags} inst\r\n * @returns {void}\r\n */\r\n\r\n/**\r\n * @callback ModalItemCallback\r\n * @param {String} value\r\n * @param {Tags} inst\r\n * @returns {Promise}\r\n */\r\n\r\n/**\r\n * @callback RenderCallback\r\n * @param {Suggestion} item\r\n * @param {String} label\r\n * @param {Tags} inst\r\n * @returns {String}\r\n */\r\n\r\n/**\r\n * @callback ItemCallback\r\n * @param {Suggestion} item\r\n * @param {Tags} inst\r\n * @returns {void}\r\n */\r\n\r\n/**\r\n * @callback ValueCallback\r\n * @param {String} value\r\n * @param {Tags} inst\r\n * @returns {void}\r\n */\r\n\r\n/**\r\n * @callback AddCallback\r\n * @param {String} value\r\n * @param {Object} data\r\n * @param {Tags} inst\r\n * @returns {void|Boolean}\r\n */\r\n\r\n/**\r\n * @callback CreateCallback\r\n * @param {HTMLOptionElement} option\r\n * @param {Tags} inst\r\n * @returns {void}\r\n */\r\n\r\n/**\r\n * @typedef Config\r\n * @property {Array<Suggestion|SuggestionGroup>} items Source items\r\n * @property {Boolean} allowNew Allows creation of new tags\r\n * @property {Boolean} showAllSuggestions Show all suggestions even if they don't match. Disables validation.\r\n * @property {String} badgeStyle Color of the badge (color can be configured per option as well)\r\n * @property {Boolean} allowClear Show a clear icon\r\n * @property {Boolean} clearEnd Place clear icon at the end\r\n * @property {Array} selected A list of initially selected values\r\n * @property {String} regex Regex for new tags\r\n * @property {Array|String} separator A list (pipe separated) of characters that should act as separator (default is using enter key)\r\n * @property {Number} max Limit to a maximum of tags (0 = no limit)\r\n * @property {String} placeholder Provides a placeholder if none are provided as the first empty option\r\n * @property {String} clearLabel Text as clear tooltip\r\n * @property {String} searchLabel Default placeholder\r\n * @property {Boolean} showDropIcon Show dropdown icon\r\n * @property {Boolean} keepOpen Keep suggestions open after selection, clear on focus out\r\n * @property {Boolean} allowSame Allow same tags used multiple times\r\n * @property {String} baseClass Customize the class applied to badges\r\n * @property {Boolean} addOnBlur Add new tags on blur (only if allowNew is enabled)\r\n * @property {Boolean} showDisabled Show disabled tags\r\n * @property {Boolean} hideNativeValidation Hide native validation tooltips\r\n * @property {Number} suggestionsThreshold Number of chars required to show suggestions\r\n * @property {Number} maximumItems Maximum number of items to display\r\n * @property {Boolean} autoselectFirst Always select the first item\r\n * @property {Boolean} updateOnSelect Update input value on selection (doesn't play nice with autoselectFirst)\r\n * @property {Boolean} highlightTyped Highlight matched part of the suggestion\r\n * @property {String} highlightClass Class applied to the mark element\r\n * @property {Boolean} fullWidth Match the width on the input field\r\n * @property {Boolean} fixed Use fixed positioning (solve overflow issues)\r\n * @property {Boolean} fuzzy Fuzzy search\r\n * @property {Boolean} startsWith Must start with the string. Defaults to false (it matches any position).\r\n * @property {Boolean} singleBadge Show badge for single elements\r\n * @property {Array} activeClasses By default: [\"bg-primary\", \"text-white\"]\r\n * @property {String} labelField Key for the label\r\n * @property {String} valueField Key for the value\r\n * @property {Array} searchFields Key for the search\r\n * @property {String} queryParam Name of the param passed to endpoint (query by default)\r\n * @property {String} server Endpoint for data provider\r\n * @property {String} serverMethod HTTP request method for data provider, default is GET\r\n * @property {String|Object} serverParams Parameters to pass along to the server. You can specify a \"related\" key with the id of a related field.\r\n * @property {String} serverDataKey By default: data\r\n * @property {Object} fetchOptions Any other fetch options (https://developer.mozilla.org/en-US/docs/Web/API/fetch#syntax)\r\n * @property {Boolean} liveServer Should the endpoint be called each time on input\r\n * @property {Boolean} noCache Prevent caching by appending a timestamp\r\n * @property {Boolean} allowHtml Allow html in input (can lead to script injection)\r\n * @property {Function} inputFilter Function to filter input\r\n * @property {Function} sanitizer Alternative function to sanitize content\r\n * @property {Number} debounceTime Debounce time for live server\r\n * @property {String} notFoundMessage Display a no suggestions found message. Leave empty to disable\r\n * @property {RenderCallback} onRenderItem Callback function that returns the suggestion\r\n * @property {ItemCallback} onSelectItem Callback function to call on selection\r\n * @property {ValueCallback} onClearItem Callback function to call on clear\r\n * @property {CreateCallback} onCreateItem Callback function when an item is created\r\n * @property {EventCallback} onBlur Callback function on blur\r\n * @property {EventCallback} onFocus Callback function on focus\r\n * @property {AddCallback} onCanAdd Callback function to validate item. Return false to show validation message.\r\n * @property {ServerCallback} onServerResponse Callback function to process server response. Must return a Promise\r\n * @property {ErrorCallback} onServerError Callback function to process server errors.\r\n * @property {ModalItemCallback} confirmClear Allow modal confirmation of clear. Must return a Promise\r\n * @property {ModalItemCallback} confirmAdd Allow modal confirmation of add. Must return a Promise\r\n */\r\n\r\n/**\r\n * @typedef Suggestion\r\n * @property {String} value Can be overriden by config valueField\r\n * @property {String} label Can be overriden by config labelField\r\n * @property {String} title\r\n * @property {Boolean} disabled\r\n * @property {Object} data\r\n * @property {Boolean} [selected]\r\n * @property {Number} [group_id]\r\n */\r\n\r\n/**\r\n * @typedef SuggestionGroup\r\n * @property {String} group\r\n * @property {Array} items\r\n */\r\n\r\n/**\r\n * @type {Config}\r\n */\r\nconst DEFAULTS = {\r\n  items: [],\r\n  allowNew: false,\r\n  showAllSuggestions: false,\r\n  badgeStyle: \"primary\",\r\n  allowClear: false,\r\n  clearEnd: false,\r\n  selected: [],\r\n  regex: \"\",\r\n  separator: [],\r\n  max: 0,\r\n  clearLabel: \"Clear\",\r\n  searchLabel: \"Type a value\",\r\n  showDropIcon: true,\r\n  keepOpen: false,\r\n  allowSame: false,\r\n  baseClass: \"\",\r\n  placeholder: \"\",\r\n  addOnBlur: false,\r\n  showDisabled: false,\r\n  hideNativeValidation: false,\r\n  suggestionsThreshold: -1,\r\n  maximumItems: 0,\r\n  autoselectFirst: true,\r\n  updateOnSelect: false,\r\n  highlightTyped: false,\r\n  highlightClass: \"\",\r\n  fullWidth: true,\r\n  fixed: false,\r\n  fuzzy: false,\r\n  startsWith: false,\r\n  singleBadge: false,\r\n  activeClasses: [\"bg-primary\", \"text-white\"],\r\n  labelField: \"label\",\r\n  valueField: \"value\",\r\n  searchFields: [\"label\"],\r\n  queryParam: \"query\",\r\n  server: \"\",\r\n  serverMethod: \"GET\",\r\n  serverParams: {},\r\n  serverDataKey: \"data\",\r\n  fetchOptions: {},\r\n  liveServer: false,\r\n  noCache: true,\r\n  allowHtml: false,\r\n  debounceTime: 300,\r\n  notFoundMessage: \"\",\r\n  inputFilter: (str) => str,\r\n  sanitizer: (str) => sanitize(str),\r\n  onRenderItem: (item, label, inst) => {\r\n    if (inst.config(\"allowHtml\")) {\r\n      return label;\r\n    }\r\n    return inst.config(\"sanitizer\")(label);\r\n  },\r\n  onSelectItem: (item, inst) => {},\r\n  onClearItem: (value, inst) => {},\r\n  onCreateItem: (option, inst) => {},\r\n  onBlur: (event, inst) => {},\r\n  onFocus: (event, inst) => {},\r\n  onCanAdd: (text, data, inst) => {},\r\n  confirmClear: (item, inst) => Promise.resolve(),\r\n  confirmAdd: (item, inst) => Promise.resolve(),\r\n  onServerResponse: (response, inst) => {\r\n    return response.json();\r\n  },\r\n  onServerError: (e, signal, inst) => {\r\n    // Current version of Firefox rejects the promise with a DOMException\r\n    if (e.name === \"AbortError\" || signal.aborted) {\r\n      return;\r\n    }\r\n    console.error(e);\r\n  },\r\n};\r\n\r\n// #endregion\r\n\r\n// #region constants\r\n\r\nconst CLASS_PREFIX = \"tags-\";\r\nconst LOADING_CLASS = \"is-loading\";\r\nconst ACTIVE_CLASS = \"is-active\";\r\nconst INVALID_CLASS = \"is-invalid\";\r\nconst MAX_REACHED_CLASS = \"is-max-reached\";\r\nconst SHOW_CLASS = \"show\";\r\nconst VALUE_ATTRIBUTE = \"data-value\";\r\nconst NEXT = \"next\";\r\nconst PREV = \"prev\";\r\nconst FOCUS_CLASS = \"form-control-focus\"; // should match form-control:focus\r\nconst PLACEHOLDER_CLASS = \"form-placeholder-shown\"; // should match :placeholder-shown\r\nconst DISABLED_CLASS = \"form-control-disabled\"; // should match form-control:disabled\r\nconst INSTANCE_MAP = new WeakMap();\r\nlet counter = 0;\r\n//@ts-ignore\r\nlet tooltip = window.bootstrap && window.bootstrap.Tooltip;\r\n\r\n// #endregion\r\n\r\n// #region functions\r\n\r\n/**\r\n * @param {Function} func\r\n * @param {number} timeout\r\n * @returns {Function}\r\n */\r\nfunction debounce(func, timeout = 300) {\r\n  let timer;\r\n  return (...args) => {\r\n    clearTimeout(timer);\r\n    timer = setTimeout(() => {\r\n      //@ts-ignore\r\n      func.apply(this, args);\r\n    }, timeout);\r\n  };\r\n}\r\n\r\n/**\r\n * @param {string} text\r\n * @param {string} size\r\n * @returns {Number}\r\n */\r\nfunction calcTextWidth(text, size = null) {\r\n  const span = ce(\"span\");\r\n  document.body.appendChild(span);\r\n  span.style.fontSize = size || \"inherit\";\r\n  span.style.height = \"auto\";\r\n  span.style.width = \"auto\";\r\n  span.style.position = \"absolute\";\r\n  span.style.whiteSpace = \"no-wrap\";\r\n  span.innerHTML = sanitize(text);\r\n  const width = Math.ceil(span.clientWidth);\r\n  document.body.removeChild(span);\r\n  return width;\r\n}\r\n\r\n/**\r\n * @link https://stackoverflow.com/questions/3043775/how-to-escape-html\r\n * @param {string} text\r\n * @returns {string}\r\n */\r\nfunction sanitize(text) {\r\n  return text.replace(/[\\x26\\x0A\\<>'\"]/g, function (r) {\r\n    return \"&#\" + r.charCodeAt(0) + \";\";\r\n  });\r\n}\r\n\r\n/**\r\n * @param {String} str\r\n * @returns {String}\r\n */\r\nfunction removeDiacritics(str) {\r\n  return str.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\");\r\n}\r\n\r\n/**\r\n * @param {String|Number} str\r\n * @returns {String}\r\n */\r\nfunction normalize(str) {\r\n  if (!str) {\r\n    return \"\";\r\n  }\r\n  return removeDiacritics(str.toString()).toLowerCase();\r\n}\r\n\r\n/**\r\n * A simple fuzzy match algorithm that checks if chars are matched\r\n * in order in the target string\r\n *\r\n * @param {String} str\r\n * @param {String} lookup\r\n * @returns {Boolean}\r\n */\r\nfunction fuzzyMatch(str, lookup) {\r\n  if (str.indexOf(lookup) >= 0) {\r\n    return true;\r\n  }\r\n  let pos = 0;\r\n  for (let i = 0; i < lookup.length; i++) {\r\n    const c = lookup[i];\r\n    if (c == \" \") continue;\r\n    pos = str.indexOf(c, pos) + 1;\r\n    if (pos <= 0) {\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\n/**\r\n * @param {HTMLElement} item\r\n */\r\nfunction hideItem(item) {\r\n  item.style.display = \"none\";\r\n  attrs(item, {\r\n    \"aria-hidden\": \"true\",\r\n  });\r\n}\r\n\r\n/**\r\n * @param {HTMLElement} item\r\n */\r\nfunction showItem(item) {\r\n  item.style.display = \"list-item\";\r\n  attrs(item, {\r\n    \"aria-hidden\": \"false\",\r\n  });\r\n}\r\n\r\n/**\r\n * @param {HTMLElement} el\r\n * @param {Object} attrs\r\n */\r\nfunction attrs(el, attrs) {\r\n  for (const [k, v] of Object.entries(attrs)) {\r\n    el.setAttribute(k, v);\r\n  }\r\n}\r\n\r\n/**\r\n * @param {HTMLElement} el\r\n * @param {string} attr\r\n */\r\nfunction rmAttr(el, attr) {\r\n  if (el.hasAttribute(attr)) {\r\n    el.removeAttribute(attr);\r\n  }\r\n}\r\n\r\n/**\r\n * Allow 1/0, true/false as strings\r\n * @param {any} value\r\n * @returns {Boolean}\r\n */\r\nfunction parseBool(value) {\r\n  return [\"true\", \"false\", \"1\", \"0\", true, false].includes(value) && !!JSON.parse(value);\r\n}\r\n\r\n/**\r\n * @template {keyof HTMLElementTagNameMap} K\r\n * @param {K|String} tagName Name of the element\r\n * @returns {*}\r\n */\r\nfunction ce(tagName) {\r\n  return document.createElement(tagName);\r\n}\r\n\r\n/**\r\n *\r\n * @param {String} str\r\n * @param {Array} tokens\r\n * @returns {Array}\r\n */\r\nfunction splitMulti(str, tokens) {\r\n  let tempChar = tokens[0];\r\n  for (let i = 1; i < tokens.length; i++) {\r\n    str = str.split(tokens[i]).join(tempChar);\r\n  }\r\n  return str.split(tempChar);\r\n}\r\n\r\nfunction nested(str, obj = \"window\") {\r\n  return str.split(\".\").reduce((r, p) => r[p], obj);\r\n}\r\n\r\n/**\r\n * @param {HTMLElement} el\r\n * @param {HTMLElement} newEl\r\n * @returns {HTMLElement}\r\n */\r\n// function insertAfter(el, newEl) {\r\n//   return el.parentNode.insertBefore(newEl, el.nextSibling);\r\n// }\r\n\r\n// #endregion\r\n\r\nclass Tags {\r\n  /**\r\n   * @param {HTMLSelectElement} el\r\n   * @param {Object|Config} config\r\n   */\r\n  constructor(el, config = {}) {\r\n    if (!(el instanceof HTMLElement)) {\r\n      console.error(\"Invalid element\", el);\r\n      return;\r\n    }\r\n    INSTANCE_MAP.set(el, this);\r\n    counter++;\r\n    this._selectElement = el;\r\n\r\n    this._configure(config);\r\n\r\n    // private vars\r\n    this._isMouse = false;\r\n    this._keyboardNavigation = false;\r\n    this._searchFunc = debounce(() => {\r\n      this._loadFromServer(true);\r\n    }, this._config.debounceTime);\r\n    this._fireEvents = true;\r\n\r\n    this._configureParent();\r\n\r\n    // Create elements\r\n    this._holderElement = ce(\"div\"); // this is the one holding the fake input and the dropmenu\r\n    this._containerElement = ce(\"div\"); // this is the one for the fake input (labels + input)\r\n    this._dropElement = ce(\"ul\"); // this dropdown list\r\n    this._searchInput = ce(\"input\"); // the input element\r\n    this._holderElement.appendChild(this._containerElement);\r\n\r\n    // insert before select, this helps having native validation tooltips positioned properly\r\n    this._selectElement.parentElement.insertBefore(this._holderElement, this._selectElement);\r\n    // insertAfter(this._selectElement, this._holderElement);\r\n\r\n    // Configure them\r\n    this._configureHolderElement();\r\n    this._configureContainerElement();\r\n    this._configureSelectElement();\r\n    this._configureSearchInput();\r\n    this._configureDropElement();\r\n    this.resetState();\r\n\r\n    // Rebind handleEvent to make sure the scope will not change\r\n    this.handleEvent = (ev) => {\r\n      this._handleEvent(ev);\r\n    };\r\n\r\n    if (this._config.fixed) {\r\n      document.addEventListener(\"scroll\", this, true); // capture input for all scrollables elements\r\n      window.addEventListener(\"resize\", this);\r\n    }\r\n\r\n    // Add listeners (remove then on dispose()). See handleEvent.\r\n    [\"focus\", \"blur\", \"input\", \"keydown\", \"paste\"].forEach((type) => {\r\n      this._searchInput.addEventListener(type, this);\r\n    });\r\n    [\"mousemove\", \"mouseleave\"].forEach((type) => {\r\n      this._dropElement.addEventListener(type, this);\r\n    });\r\n\r\n    this.loadData(true);\r\n  }\r\n\r\n  // #region Core\r\n\r\n  /**\r\n   * Attach to all elements matched by the selector\r\n   * @param {string} selector\r\n   * @param {Object} opts\r\n   * @param {Boolean} reset\r\n   */\r\n  static init(selector = \"select[multiple]\", opts = {}, reset = false) {\r\n    /**\r\n     * @type {NodeListOf<HTMLSelectElement>}\r\n     */\r\n    let list = document.querySelectorAll(selector);\r\n    for (let i = 0; i < list.length; i++) {\r\n      const inst = Tags.getInstance(list[i]);\r\n      if (inst && !reset) {\r\n        continue;\r\n      }\r\n      if (inst) {\r\n        inst.dispose();\r\n      }\r\n      new Tags(list[i], opts);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @param {HTMLSelectElement} el\r\n   */\r\n  static getInstance(el) {\r\n    if (INSTANCE_MAP.has(el)) {\r\n      return INSTANCE_MAP.get(el);\r\n    }\r\n  }\r\n\r\n  dispose() {\r\n    [\"focus\", \"blur\", \"input\", \"keydown\", \"paste\"].forEach((type) => {\r\n      this._searchInput.removeEventListener(type, this);\r\n    });\r\n    [\"mousemove\", \"mouseleave\"].forEach((type) => {\r\n      this._dropElement.removeEventListener(type, this);\r\n    });\r\n\r\n    if (this._config.fixed) {\r\n      document.removeEventListener(\"scroll\", this, true);\r\n      window.removeEventListener(\"resize\", this);\r\n    }\r\n\r\n    // restore select, remove our custom stuff and unbind parent\r\n    this._selectElement.style.display = \"block\";\r\n    this._holderElement.parentElement.removeChild(this._holderElement);\r\n    if (this.parentForm) {\r\n      this.parentForm.removeEventListener(\"reset\", this);\r\n    }\r\n\r\n    INSTANCE_MAP.delete(this._selectElement);\r\n  }\r\n\r\n  /**\r\n   * event-polyfill compat / handleEvent is expected on class\r\n   * @link https://github.com/lifaon74/events-polyfill/issues/10\r\n   * @param {Event} event\r\n   */\r\n  handleEvent(event) {\r\n    this._handleEvent(event);\r\n  }\r\n\r\n  /**\r\n   * @link https://gist.github.com/WebReflection/ec9f6687842aa385477c4afca625bbf4#handling-events\r\n   * @param {Event} event\r\n   */\r\n  _handleEvent(event) {\r\n    // debounce scroll and resize\r\n    const debounced = [\"scroll\", \"resize\"];\r\n    if (debounced.includes(event.type)) {\r\n      if (this._timer) window.cancelAnimationFrame(this._timer);\r\n      this._timer = window.requestAnimationFrame(() => {\r\n        this[`on${event.type}`](event);\r\n      });\r\n    } else {\r\n      this[`on${event.type}`](event);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @param {Config|Object} config\r\n   */\r\n  _configure(config = {}) {\r\n    this._config = Object.assign({}, DEFAULTS, {\r\n      // Hide icon by default if no value\r\n      showDropIcon: this._findOption() ? true : false,\r\n    });\r\n\r\n    const json = this._selectElement.dataset.config ? JSON.parse(this._selectElement.dataset.config) : {};\r\n    // Handle options, using arguments first, then json config and then data attr as override\r\n    const o = { ...config, ...json, ...this._selectElement.dataset };\r\n\r\n    // Typecast provided options based on defaults types\r\n    for (const [key, defaultValue] of Object.entries(DEFAULTS)) {\r\n      // Check for undefined keys\r\n      if (key == \"config\" || o[key] === void 0) {\r\n        continue;\r\n      }\r\n      const value = o[key];\r\n      switch (typeof defaultValue) {\r\n        case \"number\":\r\n          this._config[key] = parseInt(value);\r\n          break;\r\n        case \"boolean\":\r\n          this._config[key] = parseBool(value);\r\n          break;\r\n        case \"string\":\r\n          this._config[key] = value.toString();\r\n          break;\r\n        case \"object\":\r\n          this._config[key] = value;\r\n          if (typeof value === \"string\") {\r\n            if ([\"{\", \"[\"].includes(value[0])) {\r\n              // JSON like string\r\n              this._config[key] = JSON.parse(value);\r\n            } else {\r\n              // CSV or pipe separated string\r\n              this._config[key] = value.split(value.includes(\"|\") ? \"|\" : \",\");\r\n            }\r\n          }\r\n          break;\r\n        case \"function\":\r\n          // Find a global function with this name\r\n          this._config[key] = typeof value === \"string\" ? value.split(\".\").reduce((r, p) => r[p], window) : value;\r\n          if (!this._config[key]) {\r\n            console.error(\"Invalid function\", value);\r\n          }\r\n          break;\r\n        default:\r\n          this._config[key] = value;\r\n          break;\r\n      }\r\n    }\r\n\r\n    // Dynamic default values\r\n    if (!this._config.placeholder) {\r\n      this._config.placeholder = this._getPlaceholder();\r\n    }\r\n    if (this._config.suggestionsThreshold == -1) {\r\n      // if we don't have ajax auto completion, behave like a select by default\r\n      this._config.suggestionsThreshold = this._config.liveServer ? 1 : 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @param {String} k\r\n   * @returns {*}\r\n   */\r\n  config(k = null) {\r\n    return k ? this._config[k] : this._config;\r\n  }\r\n\r\n  /**\r\n   * @param {String} k\r\n   * @param {*} v\r\n   */\r\n  setConfig(k, v) {\r\n    this._config[k] = v;\r\n  }\r\n\r\n  // #endregion\r\n\r\n  // #region Html\r\n\r\n  /**\r\n   * Find overflow parent for positioning\r\n   * and bind reset event of the parent form\r\n   */\r\n  _configureParent() {\r\n    this.overflowParent = null;\r\n    this.parentForm = this._selectElement.parentElement;\r\n    while (this.parentForm) {\r\n      if (this.parentForm.style.overflow === \"hidden\") {\r\n        this.overflowParent = this.parentForm;\r\n      }\r\n      this.parentForm = this.parentForm.parentElement;\r\n      if (this.parentForm && this.parentForm.nodeName == \"FORM\") {\r\n        break;\r\n      }\r\n    }\r\n    if (this.parentForm) {\r\n      this.parentForm.addEventListener(\"reset\", this);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @returns {string}\r\n   */\r\n  _getPlaceholder() {\r\n    // Use placeholder and data-placeholder in priority\r\n    if (this._selectElement.hasAttribute(\"placeholder\")) {\r\n      return this._selectElement.getAttribute(\"placeholder\");\r\n    }\r\n    if (this._selectElement.dataset.placeholder) {\r\n      return this._selectElement.dataset.placeholder;\r\n    }\r\n    // Fallback to first option if no value\r\n    let firstOption = this._selectElement.querySelector(\"option\");\r\n    if (!firstOption || !this._config.autoselectFirst) {\r\n      return \"\";\r\n    }\r\n    rmAttr(firstOption, \"selected\");\r\n    firstOption.selected = false;\r\n    return !firstOption.value ? firstOption.textContent : \"\";\r\n  }\r\n\r\n  _configureSelectElement() {\r\n    const selectEl = this._selectElement;\r\n\r\n    // Hiding the select should keep it focusable, otherwise we get this\r\n    // An invalid form control with name='...' is not focusable.\r\n    // If it's not focusable, we need to remove the native validation attributes\r\n\r\n    // If we use display none, we don't get the focus event\r\n    // selectEl.style.display = \"none\";\r\n\r\n    // If we position it like this, the html5 validation message will not display properly\r\n    if (this._config.hideNativeValidation) {\r\n      // This position dont break render within input-group and is focusable\r\n      selectEl.style.position = \"absolute\";\r\n      selectEl.style.left = \"-9999px\";\r\n    } else {\r\n      // Hide but keep it focusable. If 0 height, no native validation message will show\r\n      // It is placed below so that native tooltip is displayed properly\r\n      // Flex basis is required for input-group otherwise it breaks the layout\r\n      selectEl.style.cssText = `height:1px;width:1px;opacity:0;padding:0;margin:0;border:0;float:left;flex-basis:100%;min-height:unset;`;\r\n    }\r\n\r\n    // Make sure it's not usable using tab\r\n    selectEl.tabIndex = -1;\r\n\r\n    // No need for custom label click event if select is focusable\r\n    // const label = document.querySelector('label[for=\"' + selectEl.getAttribute(\"id\") + '\"]');\r\n    // if (label) {\r\n    //   label.addEventListener(\"click\", this);\r\n    // }\r\n\r\n    // It can be focused by clicking on the label\r\n    selectEl.addEventListener(\"focus\", (event) => {\r\n      this.onclick(event);\r\n    });\r\n\r\n    // When using regular html5 validation, make sure our fake element get the proper class\r\n    selectEl.addEventListener(\"invalid\", (event) => {\r\n      this._holderElement.classList.add(INVALID_CLASS);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Configure drop element\r\n   * Needs to be called after searchInput is created\r\n   */\r\n  _configureDropElement() {\r\n    const dropEl = this._dropElement;\r\n    dropEl.classList.add(...[\"dropdown-menu\", CLASS_PREFIX + \"menu\"]);\r\n    dropEl.id = CLASS_PREFIX + \"menu-\" + counter;\r\n    dropEl.setAttribute(\"role\", \"menu\");\r\n\r\n    const dropStyles = dropEl.style;\r\n    dropStyles.padding = \"0\"; // avoid ugly space before option\r\n    dropStyles.maxHeight = \"280px\";\r\n    if (!this._config.fullWidth) {\r\n      dropStyles.maxWidth = \"360px\";\r\n    }\r\n    if (this._config.fixed) {\r\n      dropStyles.position = \"fixed\";\r\n    }\r\n    dropStyles.overflowY = \"auto\";\r\n    // Prevent scrolling the menu from scrolling the page\r\n    // @link https://developer.mozilla.org/en-US/docs/Web/CSS/overscroll-behavior\r\n    dropStyles.overscrollBehavior = \"contain\";\r\n    dropStyles.textAlign = \"unset\"; // otherwise RTL is not good\r\n\r\n    // If the mouse was outside, entering remove keyboard nav mode\r\n    dropEl.addEventListener(\"mouseenter\", (event) => {\r\n      this._keyboardNavigation = false;\r\n    });\r\n    this._holderElement.appendChild(dropEl);\r\n\r\n    // include aria-controls with the value of the id of the suggested list of values.\r\n    this._searchInput.setAttribute(\"aria-controls\", dropEl.id);\r\n  }\r\n\r\n  _configureHolderElement() {\r\n    const holder = this._holderElement;\r\n    holder.classList.add(...[\"form-control\", \"dropdown\"]);\r\n    // Reflect size (we must use form-select-xx because we may use form-select) and validation\r\n    [\"form-select-lg\", \"form-select-sm\", \"is-invalid\", \"is-valid\"].forEach((className) => {\r\n      if (this._selectElement.classList.contains(className)) {\r\n        holder.classList.add(className);\r\n      }\r\n    });\r\n\r\n    // It is really more like a dropdown\r\n    if (this._config.suggestionsThreshold == 0 && this._config.showDropIcon) {\r\n      holder.classList.add(\"form-select\");\r\n    }\r\n\r\n    // If we have an overflow parent, we can simply inherit styles\r\n    if (this.overflowParent) {\r\n      holder.style.position = \"inherit\";\r\n    }\r\n    // Prevent fixed height due to form-control in bs4\r\n    holder.style.height = \"auto\";\r\n\r\n    // Without this, clicking on a floating label won't always focus properly\r\n    holder.addEventListener(\"click\", this);\r\n  }\r\n\r\n  _configureContainerElement() {\r\n    this._containerElement.addEventListener(\"click\", (event) => {\r\n      if (this.isDisabled()) {\r\n        return;\r\n      }\r\n      if (this._searchInput.style.visibility != \"hidden\") {\r\n        this._searchInput.focus();\r\n      }\r\n    });\r\n\r\n    // Add some extra css to help positioning\r\n    const containerStyles = this._containerElement.style;\r\n    containerStyles.display = \"flex\";\r\n    containerStyles.alignItems = \"center\";\r\n    containerStyles.flexWrap = \"wrap\";\r\n  }\r\n\r\n  _configureSearchInput() {\r\n    const searchInput = this._searchInput;\r\n\r\n    searchInput.type = \"text\";\r\n    searchInput.autocomplete = \"off\";\r\n    searchInput.spellcheck = false;\r\n    // note: firefox doesn't support the properties so we use attributes\r\n    // @link https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Attributes/aria-autocomplete\r\n    // @link https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Attributes/aria-expanded\r\n    // use the aria-expanded state on the element with role combobox to communicate that the list is displayed.\r\n    // https://developer.mozilla.org/en-US/docs/Web/API/Element/ariaLabel\r\n    attrs(searchInput, {\r\n      \"aria-autocomplete\": \"list\",\r\n      \"aria-haspopup\": \"menu\",\r\n      \"aria-expanded\": \"false\",\r\n      \"aria-label\": this._config.searchLabel,\r\n      role: \"combobox\",\r\n    });\r\n    searchInput.style.cssText = `background-color:transparent;color:currentColor;border:0;padding:0;outline:0;max-width:100%`;\r\n    this.resetSearchInput(true);\r\n\r\n    this._containerElement.appendChild(searchInput);\r\n    this._rtl = window.getComputedStyle(searchInput).direction === \"rtl\";\r\n  }\r\n\r\n  // #endregion\r\n\r\n  // #region Events\r\n\r\n  onfocus(event) {\r\n    if (this._holderElement.classList.contains(FOCUS_CLASS)) {\r\n      return; // don't trigger multiple focus\r\n    }\r\n    this._holderElement.classList.add(FOCUS_CLASS);\r\n    this.showOrSearch();\r\n    this._config.onFocus(event, this);\r\n  }\r\n\r\n  onblur(event) {\r\n    const related = event.relatedTarget;\r\n    // Clicking on the scroll in a modal blur the element incorrectly\r\n    // In chrome >= 127, the related target is the dropdown menu\r\n    if (this._isMouse && related && (related.classList.contains(\"modal\") || related.classList.contains(CLASS_PREFIX + \"menu\"))) {\r\n      // Restore focus\r\n      this._searchInput.focus();\r\n      return;\r\n    }\r\n    this.afteronblur(event);\r\n  }\r\n\r\n  /**\r\n   * This is triggered externally by a document click handler\r\n   * Scrolling in the suggestion triggers the blur event and will close the suggestion\r\n   * so we cannot rely on the blur event of the input element\r\n   * We check for click and focus events (click when clicking outside, focus when tabbing...)\r\n   * @param {Event} event\r\n   */\r\n  afteronblur(event) {\r\n    // Cancel any pending request\r\n    if (this._abortController) {\r\n      this._abortController.abort();\r\n    }\r\n    let clearValidation = true;\r\n    if (this._config.addOnBlur && this._searchInput.value) {\r\n      clearValidation = this._enterValue();\r\n    }\r\n    this._holderElement.classList.remove(FOCUS_CLASS);\r\n    this.hideSuggestions(clearValidation);\r\n    if (this._fireEvents) {\r\n      const sel = this.getSelection();\r\n      const data = {\r\n        selection: sel ? sel.dataset.value : null,\r\n        input: this._searchInput.value,\r\n      };\r\n      this._config.onBlur(event, this);\r\n      this._selectElement.dispatchEvent(new CustomEvent(\"tags.blur\", { bubbles: true, detail: data }));\r\n    }\r\n  }\r\n\r\n  onpaste(ev) {\r\n    //@ts-ignore\r\n    const clipboardData = ev.clipboardData || window.clipboardData;\r\n    const data = clipboardData.getData(\"text/plain\").replace(/\\r\\n|\\n/g, \" \");\r\n    // Deal with copy paste including separators\r\n    if (data.length > 2 && this._config.separator.length) {\r\n      //@ts-ignore\r\n      const splitData = splitMulti(data, this._config.separator).filter((n) => n);\r\n      if (splitData.length > 1) {\r\n        ev.preventDefault();\r\n        splitData.forEach((value) => {\r\n          this._addPastedValue(value);\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  _addPastedValue(value) {\r\n    let label = value;\r\n    let addData = {};\r\n    if (!this._config.allowNew) {\r\n      const sel = this.getSelection();\r\n      if (!sel) {\r\n        return;\r\n      }\r\n      value = sel.getAttribute(VALUE_ATTRIBUTE);\r\n      label = sel.dataset.label;\r\n    } else {\r\n      addData.new = 1;\r\n    }\r\n    this._config\r\n      .confirmAdd(value, this)\r\n      .then(() => {\r\n        this._add(label, value, addData);\r\n      })\r\n      .catch(() => {});\r\n    return;\r\n  }\r\n\r\n  oninput(ev) {\r\n    const data = this._config.inputFilter(this._searchInput.value);\r\n    if (data != this._searchInput.value) {\r\n      this._searchInput.value = data;\r\n    }\r\n\r\n    // Add item if a separator is used\r\n    // On mobile or copy paste, it can pass multiple chars (eg: when pressing space and it formats the string)\r\n    if (data) {\r\n      const lastChar = data.slice(-1);\r\n      if (this._config.separator.length && this._config.separator.includes(lastChar)) {\r\n        // Remove separator even if adding is prevented\r\n        this._searchInput.value = this._searchInput.value.slice(0, -1);\r\n        let value = this._searchInput.value;\r\n        this._addPastedValue(value);\r\n        return;\r\n      }\r\n    }\r\n\r\n    // Adjust input width to current content\r\n    setTimeout(() => {\r\n      this._adjustWidth();\r\n    });\r\n\r\n    // Check if we should display suggestions\r\n    this.showOrSearch();\r\n  }\r\n\r\n  /**\r\n   * keypress doesn't send arrow keys, so we use keydown\r\n   * @param {KeyboardEvent} event\r\n   */\r\n  onkeydown(event) {\r\n    // Keycode reference : https://css-tricks.com/snippets/javascript/javascript-keycodes/\r\n    let key = event.keyCode || event.key;\r\n    /**\r\n     * @type {HTMLInputElement}\r\n     */\r\n    // @ts-ignore\r\n    const target = event.target;\r\n\r\n    // Android virtual keyboard might always return 229\r\n    if (event.keyCode == 229) {\r\n      key = target.value.charAt(target.selectionStart - 1).charCodeAt(0);\r\n    }\r\n\r\n    // Keyboard keys\r\n    switch (key) {\r\n      case 13:\r\n      case \"Enter\":\r\n        event.preventDefault();\r\n        this._enterValue();\r\n        break;\r\n      case 38:\r\n      case \"ArrowUp\":\r\n        event.preventDefault();\r\n        this._keyboardNavigation = true;\r\n        this._moveSelection(PREV);\r\n        break;\r\n      case 40:\r\n      case \"ArrowDown\":\r\n        event.preventDefault();\r\n        this._keyboardNavigation = true;\r\n        if (this.isDropdownVisible()) {\r\n          this._moveSelection(NEXT);\r\n        } else {\r\n          // show menu regardless of input length\r\n          this.showOrSearch(false);\r\n        }\r\n        break;\r\n      case 8:\r\n      case \"Backspace\":\r\n        // If the current item is empty, remove the last one\r\n        const lastItem = this.getLastItem();\r\n        if (this._searchInput.value.length == 0 && lastItem) {\r\n          this._config\r\n            .confirmClear(lastItem, this)\r\n            .then(() => {\r\n              this.removeLastItem();\r\n              this._adjustWidth();\r\n              this.showOrSearch();\r\n            })\r\n            .catch(() => {});\r\n        }\r\n        break;\r\n      case 27:\r\n      case \"Escape\":\r\n        this._searchInput.focus();\r\n        this.hideSuggestions();\r\n        break;\r\n    }\r\n  }\r\n\r\n  onmousemove(e) {\r\n    this._isMouse = true;\r\n    // Moving the mouse means no longer using keyboard\r\n    this._keyboardNavigation = false;\r\n  }\r\n\r\n  onmouseleave(e) {\r\n    this._isMouse = false;\r\n    // remove selection\r\n    this.removeSelection();\r\n  }\r\n\r\n  onscroll(e) {\r\n    this._positionMenu();\r\n  }\r\n\r\n  onresize(e) {\r\n    this._positionMenu();\r\n  }\r\n\r\n  onclick(e = null) {\r\n    if (!this.isSingle() && this.isMaxReached()) {\r\n      return;\r\n    }\r\n    // Focus on input when clicking on element or focusing select\r\n    this._searchInput.focus();\r\n  }\r\n\r\n  onreset(e) {\r\n    this.reset();\r\n  }\r\n\r\n  // #endregion\r\n\r\n  /**\r\n   * @param {Boolean} init called during init\r\n   */\r\n  loadData(init = false) {\r\n    if (Object.keys(this._config.items).length > 0) {\r\n      this.setData(this._config.items, true);\r\n    } else {\r\n      // This will setData at the end\r\n      this.resetSuggestions(true);\r\n    }\r\n\r\n    if (this._config.server) {\r\n      if (this._config.liveServer) {\r\n        // No need to load anything since it will happen when typing\r\n        // Initial values are loaded from config items or from provided options\r\n      } else {\r\n        this._loadFromServer(!init);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Make sure we have valid selected attributes\r\n   */\r\n  _setSelectedAttributes() {\r\n    // we use selectedOptions because single select can have a selected option without a selected attribute if it's the first value\r\n    const selectedOptions = this._selectElement.selectedOptions || [];\r\n    for (let j = 0; j < selectedOptions.length; j++) {\r\n      // Enforce selected attr for consistency\r\n      if (selectedOptions[j].value && !selectedOptions[j].hasAttribute(\"selected\")) {\r\n        selectedOptions[j].setAttribute(\"selected\", \"selected\");\r\n      }\r\n    }\r\n  }\r\n\r\n  resetState() {\r\n    if (this.isDisabled()) {\r\n      this._holderElement.setAttribute(\"readonly\", \"\");\r\n      this._searchInput.setAttribute(\"disabled\", \"\");\r\n      this._holderElement.classList.add(DISABLED_CLASS);\r\n    } else {\r\n      rmAttr(this._holderElement, \"readonly\");\r\n      rmAttr(this._searchInput, \"disabled\");\r\n      this._holderElement.classList.remove(DISABLED_CLASS);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Reset suggestions from select element\r\n   * Iterates over option children then calls setData\r\n   * @param {Boolean} init called during init\r\n   */\r\n  resetSuggestions(init = false) {\r\n    this._setSelectedAttributes();\r\n\r\n    const convertOption = (option) => {\r\n      return {\r\n        value: option.getAttribute(\"value\"),\r\n        label: option.textContent,\r\n        disabled: option.disabled,\r\n        //@ts-ignore\r\n        selected: option.selected,\r\n        title: option.title,\r\n        data: Object.assign(\r\n          {\r\n            disabled: option.disabled, // pass as data as well\r\n          },\r\n          option.dataset\r\n        ),\r\n      };\r\n    };\r\n\r\n    let suggestions = Array.from(this._selectElement.children)\r\n      .filter(\r\n        /**\r\n         * @param {HTMLOptionElement|HTMLOptGroupElement} option\r\n         */\r\n        (option) => {\r\n          return option.hasAttribute(\"label\") || !option.disabled || this._config.showDisabled;\r\n        }\r\n      )\r\n      .map(\r\n        /**\r\n         * @param {HTMLOptionElement|HTMLOptGroupElement} option\r\n         */\r\n        (option) => {\r\n          if (option.hasAttribute(\"label\")) {\r\n            return {\r\n              group: option.getAttribute(\"label\"),\r\n              items: Array.from(option.children).map((option) => {\r\n                return convertOption(option);\r\n              }),\r\n            };\r\n          }\r\n          return convertOption(option);\r\n        }\r\n      );\r\n\r\n    this.setData(suggestions, init);\r\n  }\r\n\r\n  /**\r\n   * Try to add the current value\r\n   * @returns {Boolean}\r\n   */\r\n  _enterValue() {\r\n    let selection = this.getSelection();\r\n    if (selection) {\r\n      selection.click();\r\n      return true;\r\n    } else {\r\n      // We use what is typed if not selected and not empty\r\n      if (this._config.allowNew && this._searchInput.value) {\r\n        let text = this._searchInput.value;\r\n        this._config\r\n          .confirmAdd(text, this)\r\n          .then(() => {\r\n            this._add(text, text, { new: 1 });\r\n          })\r\n          .catch(() => {});\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * @param {Boolean} show Show menu after load. False during init\r\n   */\r\n  _loadFromServer(show = false) {\r\n    if (this._abortController) {\r\n      this._abortController.abort();\r\n    }\r\n    this._abortController = new AbortController();\r\n\r\n    // Read data params dynamically as well (eg: for vue JS)\r\n    let extraParams = this._selectElement.dataset.serverParams || {};\r\n    if (typeof extraParams == \"string\") {\r\n      extraParams = JSON.parse(extraParams);\r\n    }\r\n    const params = Object.assign({}, this._config.serverParams, extraParams);\r\n    // Pass current value\r\n    params[this._config.queryParam] = this._searchInput.value;\r\n    // Prevent caching\r\n    if (this._config.noCache) {\r\n      params.t = Date.now();\r\n    }\r\n    // We have a related field\r\n    if (params.related) {\r\n      /**\r\n       * @type {HTMLInputElement}\r\n       */\r\n      //@ts-ignore\r\n      const input = document.getElementById(params.related);\r\n      if (input) {\r\n        params.related = input.value;\r\n        const inputName = input.getAttribute(\"name\");\r\n        if (inputName) {\r\n          params[inputName] = input.value;\r\n        }\r\n      }\r\n    }\r\n\r\n    const urlParams = new URLSearchParams(params);\r\n    let url = this._config.server;\r\n    let fetchOptions = Object.assign(this._config.fetchOptions, {\r\n      method: this._config.serverMethod || \"GET\",\r\n      signal: this._abortController.signal,\r\n    });\r\n\r\n    if (fetchOptions.method === \"POST\") {\r\n      fetchOptions.body = urlParams;\r\n    } else {\r\n      url += \"?\" + urlParams.toString();\r\n    }\r\n\r\n    this._holderElement.classList.add(LOADING_CLASS);\r\n    fetch(url, fetchOptions)\r\n      .then((r) => this._config.onServerResponse(r, this))\r\n      .then((suggestions) => {\r\n        const data = nested(this._config.serverDataKey, suggestions) || suggestions;\r\n        this.setData(data, !show);\r\n        this._abortController = null;\r\n        if (show) {\r\n          this._showSuggestions();\r\n        }\r\n      })\r\n      .catch((e) => {\r\n        this._config.onServerError(e, this._abortController.signal, this);\r\n      })\r\n      .finally((e) => {\r\n        this._holderElement.classList.remove(LOADING_CLASS);\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Wrapper for the public addItem method that check if the item\r\n   * can be added\r\n   *\r\n   * @param {string} text\r\n   * @param {string} value\r\n   * @param {object} data\r\n   * @returns {HTMLOptionElement|null}\r\n   */\r\n  _add(text, value = null, data = {}) {\r\n    // Pass along value in data for canAdd()\r\n    if(!data.value && value) {\r\n      data.value = value;\r\n    }\r\n    if (!this.canAdd(text, data)) {\r\n      return null;\r\n    }\r\n    const el = this.addItem(text, value, data);\r\n    this._resetHtmlState();\r\n    if (this._config.keepOpen) {\r\n      this._showSuggestions();\r\n    } else {\r\n      this.resetSearchInput();\r\n    }\r\n\r\n    return el;\r\n  }\r\n\r\n  /**\r\n   * @param {HTMLElement} li\r\n   * @returns {Boolean}\r\n   */\r\n  _isItemEnabled(li) {\r\n    if (li.style.display === \"none\") {\r\n      return false;\r\n    }\r\n    const fc = li.firstElementChild;\r\n    return fc.tagName === \"A\" && !fc.classList.contains(\"disabled\");\r\n  }\r\n\r\n  /**\r\n   * @param {String} dir\r\n   * @param {*|HTMLElement} sel\r\n   * @returns {HTMLElement}\r\n   */\r\n  _moveSelection(dir = NEXT, sel = null) {\r\n    const active = this.getSelection();\r\n\r\n    // select first li if visible\r\n    if (!active) {\r\n      // no active selection, cannot go back\r\n      if (dir === PREV) {\r\n        return sel;\r\n      }\r\n      // find first enabled item\r\n      if (!sel) {\r\n        sel = this._dropElement.firstChild;\r\n        while (sel && !this._isItemEnabled(sel)) {\r\n          sel = sel[\"nextSibling\"];\r\n        }\r\n      }\r\n    } else {\r\n      const sibling = dir === NEXT ? \"nextSibling\" : \"previousSibling\";\r\n\r\n      // Iterate over visible li\r\n      sel = active.parentNode;\r\n      do {\r\n        sel = sel[sibling];\r\n      } while (sel && !this._isItemEnabled(sel));\r\n\r\n      // We have a new selection\r\n      if (sel) {\r\n        // Remove classes from current active\r\n        active.classList.remove(...this._activeClasses());\r\n      } else if (active) {\r\n        // Use active element as selection\r\n        sel = active.parentElement;\r\n      }\r\n    }\r\n\r\n    if (sel) {\r\n      // Scroll if necessary\r\n      const selHeight = sel.offsetHeight;\r\n      const selTop = sel.offsetTop;\r\n      const parent = sel.parentNode;\r\n      const parentHeight = parent.offsetHeight;\r\n      const parentScrollHeight = parent.scrollHeight;\r\n      const parentTop = parent.offsetTop;\r\n\r\n      // Reset scroll, this can happen if menu was scrolled then hidden\r\n      if (selHeight === 0) {\r\n        setTimeout(() => {\r\n          parent.scrollTop = 0;\r\n        });\r\n      }\r\n\r\n      if (dir === PREV) {\r\n        // Don't use scrollIntoView as it scrolls the whole window\r\n        // Avoid minor top scroll due to headers\r\n        const scrollTop = selTop - parentTop > 10 ? selTop - parentTop : 0;\r\n        parent.scrollTop = scrollTop;\r\n      } else {\r\n        // This is the equivalent of scrollIntoView(false) but only for parent node\r\n        // Only scroll if the element is not visible\r\n        const scrollNeeded = selTop + selHeight - (parentHeight + parent.scrollTop);\r\n        if (scrollNeeded > 0 && selHeight > 0) {\r\n          parent.scrollTop = selTop + selHeight - parentHeight + 1;\r\n          // On last element, make sure we scroll the the bottom\r\n          if (parent.scrollTop + parentHeight >= parentScrollHeight - 10) {\r\n            parent.scrollTop = selTop - parentTop;\r\n          }\r\n        }\r\n      }\r\n\r\n      // Adjust link\r\n      const a = sel.querySelector(\"a\");\r\n      a.classList.add(...this._activeClasses());\r\n      this._searchInput.setAttribute(\"aria-activedescendant\", a.id);\r\n      if (this._config.updateOnSelect) {\r\n        this._searchInput.value = a.dataset.label;\r\n        this._adjustWidth();\r\n      }\r\n    } else {\r\n      this._searchInput.setAttribute(\"aria-activedescendant\", \"\");\r\n    }\r\n    return sel;\r\n  }\r\n\r\n  /**\r\n   * Adjust the field to fit its content and show/hide placeholder if needed\r\n   */\r\n  _adjustWidth() {\r\n    this._holderElement.classList.remove(PLACEHOLDER_CLASS);\r\n    if (this._searchInput.value) {\r\n      this._searchInput.size = this._searchInput.value.length;\r\n    } else {\r\n      // Show the placeholder only if empty\r\n      if (this.getSelectedValues().length) {\r\n        this._searchInput.placeholder = \"\";\r\n        this._searchInput.size = 1;\r\n      } else {\r\n        this._searchInput.size = this._config.placeholder.length > 0 ? this._config.placeholder.length : 1;\r\n        this._searchInput.placeholder = this._config.placeholder;\r\n        this._holderElement.classList.add(PLACEHOLDER_CLASS);\r\n      }\r\n    }\r\n\r\n    // If the string contains ascii chars or strange font, input size may be wrong\r\n    // We cannot only rely on the size attribute\r\n    const v = this._searchInput.value || this._searchInput.placeholder;\r\n    const computedFontSize = window.getComputedStyle(this._holderElement).fontSize;\r\n    const w = calcTextWidth(v, computedFontSize) + 16;\r\n    this._searchInput.style.width = w + \"px\"; // Don't use minWidth as it would prevent using maxWidth\r\n  }\r\n\r\n  /**\r\n   * Add suggestions to the drop element\r\n   * @param {Array<Suggestion|SuggestionGroup>} suggestions\r\n   */\r\n  _buildSuggestions(suggestions) {\r\n    while (this._dropElement.lastChild) {\r\n      this._dropElement.removeChild(this._dropElement.lastChild);\r\n    }\r\n    let idx = 0;\r\n    let groupId = 1; // start at one, because data-id = \"\" + 0 doesn't do anything\r\n    for (let i = 0; i < suggestions.length; i++) {\r\n      const suggestion = suggestions[i];\r\n\r\n      if (!suggestion) {\r\n        continue;\r\n      }\r\n\r\n      // Handle optgroups\r\n      if (suggestion[\"group\"] && suggestion[\"items\"]) {\r\n        const newChild = ce(\"li\");\r\n        newChild.setAttribute(\"role\", \"presentation\");\r\n        newChild.dataset.id = \"\" + groupId;\r\n        const newChildSpan = ce(\"span\");\r\n        newChild.append(newChildSpan);\r\n        newChildSpan.classList.add(...[\"dropdown-header\", \"text-truncate\"]);\r\n        newChildSpan.innerHTML = this._config.sanitizer(suggestion[\"group\"]);\r\n        this._dropElement.appendChild(newChild);\r\n\r\n        if (suggestion[\"items\"]) {\r\n          for (let j = 0; j < suggestion[\"items\"].length; j++) {\r\n            const groupSuggestion = suggestion[\"items\"][j];\r\n            groupSuggestion.group_id = groupId;\r\n            this._buildSuggestionsItem(suggestion[\"items\"][j], idx);\r\n            idx++;\r\n          }\r\n        }\r\n\r\n        groupId++;\r\n      }\r\n\r\n      //@ts-ignore\r\n      this._buildSuggestionsItem(suggestion, idx);\r\n      idx++;\r\n    }\r\n\r\n    // Create the not found message\r\n    if (this._config.notFoundMessage) {\r\n      const notFound = ce(\"li\");\r\n      notFound.setAttribute(\"role\", \"presentation\");\r\n      notFound.classList.add(CLASS_PREFIX + \"not-found\");\r\n      // Actual message is refreshed on typing, but we need item for consistency\r\n      notFound.innerHTML = `<span class=\"dropdown-item\"></span>`;\r\n      this._dropElement.appendChild(notFound);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @param {Suggestion} suggestion\r\n   * @param {Number} i The global counter\r\n   */\r\n  _buildSuggestionsItem(suggestion, i) {\r\n    if (!suggestion[this._config.valueField]) {\r\n      return;\r\n    }\r\n\r\n    const value = suggestion[this._config.valueField];\r\n    const label = suggestion[this._config.labelField];\r\n\r\n    let textContent = this._config.onRenderItem(suggestion, label, this);\r\n\r\n    const newChild = ce(\"li\");\r\n    // role must be menuitem when used with menu\r\n    // see https://github.com/lekoala/bootstrap5-tags/issues/114\r\n    newChild.setAttribute(\"role\", \"menuitem\");\r\n    if (suggestion.group_id) {\r\n      newChild.setAttribute(\"data-group-id\", \"\" + suggestion.group_id);\r\n    }\r\n    if (suggestion.title) {\r\n      newChild.setAttribute(\"title\", suggestion.title);\r\n      newChild.setAttribute(\"data-bs-placement\", \"left\");\r\n    }\r\n    const newChildLink = ce(\"a\");\r\n    newChild.append(newChildLink);\r\n    newChildLink.id = this._dropElement.id + \"-\" + i;\r\n    newChildLink.classList.add(...[\"dropdown-item\", \"text-truncate\"]);\r\n    if (suggestion.disabled) {\r\n      newChildLink.classList.add(...[\"disabled\"]);\r\n    }\r\n    newChildLink.setAttribute(VALUE_ATTRIBUTE, value);\r\n    newChildLink.dataset.label = label;\r\n\r\n    const searchData = {};\r\n    this._config.searchFields.forEach((sf) => {\r\n      searchData[sf] = suggestion[sf];\r\n    });\r\n    newChildLink.dataset.searchData = JSON.stringify(searchData);\r\n    newChildLink.setAttribute(\"href\", \"#\");\r\n    // sanitized if needed by onRenderItem\r\n    newChildLink.innerHTML = textContent;\r\n    this._dropElement.appendChild(newChild);\r\n\r\n    // tooltips\r\n    const v5 = this._getBootstrapVersion() === 5;\r\n    if (suggestion.title && tooltip && v5) {\r\n      tooltip.getOrCreateInstance(newChild);\r\n    }\r\n\r\n    // Hover sets active item\r\n    newChildLink.addEventListener(\"mouseenter\", (event) => {\r\n      // Don't trigger enter if using arrows\r\n      if (this._keyboardNavigation) {\r\n        return;\r\n      }\r\n      this.removeSelection();\r\n      newChild.querySelector(\"a\").classList.add(...this._activeClasses());\r\n    });\r\n    newChildLink.addEventListener(\"mousedown\", (event) => {\r\n      // Otherwise searchInput would lose focus and close the menu\r\n      event.preventDefault();\r\n    });\r\n    newChildLink.addEventListener(\"click\", (event) => {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n      this._config\r\n        .confirmAdd(value, this)\r\n        .then(() => {\r\n          this._add(label, value, suggestion.data);\r\n          this._config.onSelectItem(suggestion, this);\r\n        })\r\n        .catch(() => {});\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @returns {NodeListOf<HTMLOptionElement>}\r\n   */\r\n  initialOptions() {\r\n    return this._selectElement.querySelectorAll(\"option[data-init]\");\r\n  }\r\n\r\n  /**\r\n   * Call this before looping in a list that calls addItem\r\n   * This will make sure addItem will not add incorrectly options to the select\r\n   */\r\n  _removeSelectedAttrs() {\r\n    this._selectElement.querySelectorAll(\"option\").forEach((opt) => {\r\n      rmAttr(opt, \"selected\");\r\n    });\r\n  }\r\n\r\n  reset() {\r\n    this.removeAll();\r\n\r\n    // Reset doesn't fire change event\r\n    this._fireEvents = false;\r\n    const opts = this.initialOptions();\r\n    this._removeSelectedAttrs();\r\n    for (let j = 0; j < opts.length; j++) {\r\n      const iv = opts[j];\r\n      const data = Object.assign(\r\n        {},\r\n        {\r\n          disabled: iv.hasAttribute(\"disabled\"),\r\n        },\r\n        iv.dataset\r\n      );\r\n      this.addItem(iv.textContent, iv.value, data);\r\n    }\r\n    this._resetHtmlState();\r\n    this._fireEvents = true;\r\n  }\r\n\r\n  /**\r\n   * @param {Boolean} init Pass true during init\r\n   */\r\n  resetSearchInput(init = false) {\r\n    this._searchInput.value = \"\";\r\n    this._adjustWidth();\r\n\r\n    this._checkMax();\r\n\r\n    // Single select is a special case\r\n    if (this.isSingle() && !init) {\r\n      //@ts-ignore\r\n      document.activeElement.blur();\r\n      this.hideSuggestions();\r\n\r\n      return;\r\n    }\r\n\r\n    // Extra things to do when not during init\r\n    if (!init) {\r\n      if (!this._shouldShow()) {\r\n        this.hideSuggestions();\r\n      }\r\n\r\n      // Trigger input even to show suggestions if needed when focused\r\n      if (this._searchInput === document.activeElement) {\r\n        this._searchInput.dispatchEvent(new Event(\"input\"));\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * We use visibility instead of display to keep layout intact\r\n   */\r\n  _checkMax() {\r\n    if (this.isMaxReached()) {\r\n      this._holderElement.classList.add(MAX_REACHED_CLASS);\r\n      this._searchInput.style.visibility = \"hidden\";\r\n    } else {\r\n      if (this._searchInput.style.visibility == \"hidden\") {\r\n        this._searchInput.style.visibility = \"visible\";\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @returns {Array}\r\n   */\r\n  getSelectedValues() {\r\n    // option[selected] is used rather that selectedOptions as it works more consistently\r\n    /**\r\n     * @type {NodeListOf<HTMLOptionElement>}\r\n     */\r\n    const selected = this._selectElement.querySelectorAll(\"option[selected]\");\r\n    return Array.from(selected).map((el) => el.value);\r\n  }\r\n\r\n  /**\r\n   * @returns {Array}\r\n   */\r\n  getAvailableValues() {\r\n    /**\r\n     * @type {NodeListOf<HTMLOptionElement>}\r\n     */\r\n    const selected = this._selectElement.querySelectorAll(\"option\");\r\n    return Array.from(selected).map((el) => el.value);\r\n  }\r\n\r\n  /**\r\n   * Show suggestions or search them depending on live server\r\n   * @param {Boolean} check\r\n   */\r\n  showOrSearch(check = true) {\r\n    if (check && !this._shouldShow()) {\r\n      // focusing should not clear validation\r\n      this.hideSuggestions(false);\r\n      return;\r\n    }\r\n    if (this._config.liveServer) {\r\n      this._searchFunc();\r\n    } else {\r\n      this._showSuggestions();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The element create with buildSuggestions\r\n   * @param {Boolean} clearValidation\r\n   */\r\n  hideSuggestions(clearValidation = true) {\r\n    this._dropElement.classList.remove(SHOW_CLASS);\r\n    attrs(this._searchInput, {\r\n      \"aria-expanded\": \"false\",\r\n    });\r\n    this.removeSelection();\r\n    if (clearValidation) {\r\n      this._holderElement.classList.remove(INVALID_CLASS);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show or hide suggestions\r\n   * @param {Boolean} check Show suggestions regardless if shouldShow conditions\r\n   * @param {Boolean} clearValidation\r\n   */\r\n  toggleSuggestions(check = true, clearValidation = true) {\r\n    if (this._dropElement.classList.contains(SHOW_CLASS)) {\r\n      this.hideSuggestions(clearValidation);\r\n    } else {\r\n      this.showOrSearch(check);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Do we have enough input to show suggestions ?\r\n   * @returns {Boolean}\r\n   */\r\n  _shouldShow() {\r\n    if (this.isDisabled() || this.isMaxReached()) {\r\n      return false;\r\n    }\r\n    return this._searchInput.value.length >= this._config.suggestionsThreshold;\r\n  }\r\n\r\n  /**\r\n   * The element create with buildSuggestions\r\n   */\r\n  _showSuggestions() {\r\n    // Never show suggestions if you cannot add new values\r\n    if (this._searchInput.style.visibility == \"hidden\") {\r\n      return;\r\n    }\r\n\r\n    const lookup = normalize(this._searchInput.value);\r\n\r\n    const valueCounter = {};\r\n\r\n    // Filter the list according to search string\r\n    const list = this._dropElement.querySelectorAll(\"li\");\r\n    let count = 0;\r\n    let firstItem = null;\r\n    let hasPossibleValues = false;\r\n    let visibleGroups = {};\r\n    for (let i = 0; i < list.length; i++) {\r\n      /**\r\n       * @type {HTMLLIElement}\r\n       */\r\n      let item = list[i];\r\n      /**\r\n       * @type {HTMLAnchorElement|HTMLSpanElement}\r\n       */\r\n      //@ts-ignore\r\n      let link = item.firstElementChild;\r\n\r\n      // This is the empty result message or a header\r\n      if (link instanceof HTMLSpanElement) {\r\n        // We will show it later\r\n        if (item.dataset.id) {\r\n          visibleGroups[item.dataset.id] = false;\r\n        }\r\n        hideItem(item);\r\n        continue;\r\n      }\r\n\r\n      // Remove previous selection\r\n      link.classList.remove(...this._activeClasses());\r\n\r\n      // Hide selected values\r\n      if (!this._config.allowSame) {\r\n        const v = link.getAttribute(VALUE_ATTRIBUTE);\r\n        // Find if the matching option is already selected by index to deal with same values\r\n        valueCounter[v] = valueCounter[v] || 0;\r\n        const opt = this._findOption(link.getAttribute(VALUE_ATTRIBUTE), \"[selected]\", valueCounter[v]++);\r\n        if (opt) {\r\n          hideItem(item);\r\n          continue;\r\n        }\r\n      }\r\n\r\n      // Check search length since we can trigger dropdown with arrow\r\n      const showAllSuggestions = this._config.showAllSuggestions || lookup.length === 0;\r\n      // Do we find a matching string or do we display immediately ?\r\n      let isMatched = lookup.length == 0 && this._config.suggestionsThreshold === 0;\r\n      if (!showAllSuggestions && lookup.length > 0) {\r\n        // match on any field\r\n        const searchData = JSON.parse(link.dataset.searchData);\r\n        this._config.searchFields.forEach((sf) => {\r\n          const text = normalize(searchData[sf]);\r\n          let found = false;\r\n          if (this._config.fuzzy) {\r\n            found = fuzzyMatch(text, lookup);\r\n          } else {\r\n            const idx = text.indexOf(lookup);\r\n            found = this._config.startsWith ? idx === 0 : idx >= 0;\r\n          }\r\n          if (found) {\r\n            isMatched = true;\r\n          }\r\n        });\r\n      }\r\n\r\n      const selectFirst = isMatched || lookup.length === 0;\r\n      if (showAllSuggestions || isMatched) {\r\n        count++;\r\n        showItem(item);\r\n        if (item.dataset.groupId) {\r\n          visibleGroups[item.dataset.groupId] = true;\r\n        }\r\n        // Only select as first item if its matching or no lookup\r\n        if (!firstItem && this._isItemEnabled(item) && selectFirst) {\r\n          firstItem = item;\r\n        }\r\n        if (this._config.maximumItems > 0 && count > this._config.maximumItems) {\r\n          hideItem(item);\r\n        }\r\n      } else {\r\n        hideItem(item);\r\n      }\r\n\r\n      if (this._config.highlightTyped) {\r\n        // using .textContent removes any html that can be present (eg: mark added through highlightTyped)\r\n        const textContent = link.textContent;\r\n        const idx = normalize(textContent).indexOf(lookup);\r\n        const highlighted =\r\n          textContent.substring(0, idx) +\r\n          `<mark class=\"${this._config.highlightClass}\">${textContent.substring(idx, idx + lookup.length)}</mark>` +\r\n          textContent.substring(idx + lookup.length, textContent.length);\r\n        link.innerHTML = highlighted;\r\n      }\r\n\r\n      if (this._isItemEnabled(item)) {\r\n        hasPossibleValues = true;\r\n      }\r\n    }\r\n\r\n    // No item and we don't allow new items => error\r\n    if (!this._config.allowNew && !(lookup.length === 0 && !hasPossibleValues)) {\r\n      this._holderElement.classList.add(INVALID_CLASS);\r\n    }\r\n\r\n    // If we allow new elements, regex validation should happen on canAdd instead\r\n    if (this._config.allowNew && this._config.regex && this.isInvalid()) {\r\n      this._holderElement.classList.remove(INVALID_CLASS);\r\n    }\r\n\r\n    // Show all groups with visible values\r\n    Array.from(list)\r\n      .filter((li) => {\r\n        return li.dataset.id;\r\n      })\r\n      .forEach((li) => {\r\n        if (visibleGroups[li.dataset.id] === true) {\r\n          showItem(li);\r\n        }\r\n      });\r\n\r\n    if (hasPossibleValues) {\r\n      // Remove validation message if we show selectable values\r\n      this._holderElement.classList.remove(INVALID_CLASS);\r\n\r\n      // Autoselect first\r\n      if (firstItem && this._config.autoselectFirst) {\r\n        this.removeSelection();\r\n        this._moveSelection(NEXT, firstItem);\r\n      }\r\n    }\r\n\r\n    // Remove dropdown if list is empty\r\n    if (count === 0) {\r\n      if (this._config.notFoundMessage) {\r\n        /**\r\n         * @type {HTMLElement}\r\n         */\r\n        const notFound = this._dropElement.querySelector(\".\" + CLASS_PREFIX + \"not-found\");\r\n        notFound.style.display = \"block\";\r\n        const notFoundMessage = this._config.notFoundMessage.replace(\"{{tag}}\", this._searchInput.value);\r\n        notFound.innerHTML = `<span class=\"dropdown-item\">${notFoundMessage}</span>`;\r\n        this._showDropdown();\r\n      } else {\r\n        // Remove dropdown if not found (do not clear validation)\r\n        this.hideSuggestions(false);\r\n      }\r\n    } else {\r\n      // Or show it if necessary\r\n      this._showDropdown();\r\n    }\r\n  }\r\n\r\n  _showDropdown() {\r\n    const isVisible = this._dropElement.classList.contains(SHOW_CLASS);\r\n    if (!isVisible) {\r\n      this._dropElement.classList.add(SHOW_CLASS);\r\n      attrs(this._searchInput, {\r\n        \"aria-expanded\": \"true\",\r\n      });\r\n    }\r\n    this._positionMenu(isVisible);\r\n  }\r\n\r\n  /**\r\n   * @param {Boolean} wasVisible\r\n   */\r\n  _positionMenu(wasVisible = false) {\r\n    const isRTL = this._rtl;\r\n    const fixed = this._config.fixed;\r\n    const fullWidth = this._config.fullWidth;\r\n    const bounds = this._searchInput.getBoundingClientRect();\r\n    const holderBounds = this._holderElement.getBoundingClientRect();\r\n\r\n    let left = 0;\r\n    let top = 0;\r\n\r\n    if (fixed) {\r\n      // In full width, use holder as left reference, otherwise use input\r\n      if (fullWidth) {\r\n        left = holderBounds.x;\r\n        top = holderBounds.y + holderBounds.height + 2; // 2px offset\r\n      } else {\r\n        left = bounds.x;\r\n        top = bounds.y + bounds.height;\r\n      }\r\n    } else {\r\n      // When positioning is not fixed, we leave it up to the browser\r\n      // it may not work in complex situations with scrollable overflows, etc\r\n      if (fullWidth) {\r\n        // Stick it at the start\r\n        left = 0;\r\n        // Move it below\r\n        top = holderBounds.height + 2; // 2px offset\r\n      } else {\r\n        // Position next to input (offsetLeft != bounds.x)\r\n        left = this._searchInput.offsetLeft;\r\n        top = this._searchInput.offsetHeight + this._searchInput.offsetTop;\r\n      }\r\n    }\r\n\r\n    // Align end\r\n    if (isRTL && !fullWidth) {\r\n      left -= this._dropElement.offsetWidth - bounds.width;\r\n    }\r\n\r\n    // Horizontal overflow\r\n    if (!fullWidth) {\r\n      const w = Math.min(window.innerWidth, document.body.offsetWidth);\r\n      const hdiff = isRTL\r\n        ? bounds.x + bounds.width - this._dropElement.offsetWidth - 1\r\n        : w - 1 - (bounds.x + this._dropElement.offsetWidth);\r\n      if (hdiff < 0) {\r\n        left = isRTL ? left - hdiff : left + hdiff;\r\n      }\r\n    }\r\n\r\n    // Use full holder width\r\n    if (fullWidth) {\r\n      this._dropElement.style.width = this._holderElement.offsetWidth + \"px\";\r\n    }\r\n\r\n    if (!wasVisible) {\r\n      // Reset any height overflow adjustement\r\n      this._dropElement.style.transform = \"unset\";\r\n    }\r\n\r\n    Object.assign(this._dropElement.style, {\r\n      // Position element\r\n      left: left + \"px\",\r\n      top: top + \"px\",\r\n    });\r\n\r\n    // Overflow height\r\n    const dropBounds = this._dropElement.getBoundingClientRect();\r\n    const h = window.innerHeight;\r\n\r\n    // We display above input if it overflows\r\n    if (dropBounds.y + dropBounds.height > h || this._dropElement.style.transform.includes(\"translateY\")) {\r\n      // We need to add the offset twice\r\n      const topOffset = fullWidth ? holderBounds.height + 4 : bounds.height;\r\n      // In chrome, we need 100.1% to avoid blurry text\r\n      // @link https://stackoverflow.com/questions/32034574/font-looks-blurry-after-translate-in-chrome\r\n      this._dropElement.style.transform = \"translateY(calc(-100.1% - \" + topOffset + \"px))\";\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @returns {Number}\r\n   */\r\n  _getBootstrapVersion() {\r\n    let ver = 5;\r\n    // If we have jQuery and the tooltip plugin for BS4\r\n    //@ts-ignore\r\n    let jq = window.jQuery;\r\n    if (jq && jq.fn.tooltip && jq.fn.tooltip.Constructor) {\r\n      ver = parseInt(jq.fn.tooltip.Constructor.VERSION.charAt(0));\r\n    }\r\n    return ver;\r\n  }\r\n\r\n  /**\r\n   * Find if label is already selected (based on attribute)\r\n   * @param {string} text\r\n   * @returns {Boolean}\r\n   */\r\n  _isSelected(text) {\r\n    const arr = Array.from(this._selectElement.querySelectorAll(\"option\"));\r\n    const selOpt = arr.find((el) => el.textContent == text && el.getAttribute(\"selected\"));\r\n    return selOpt ? true : false;\r\n  }\r\n\r\n  /**\r\n   * Find if label is already selectable (based on attribute)\r\n   * @param {string} text\r\n   * @param {Object} data\r\n   * @returns {Boolean}\r\n   */\r\n  _isSelectable(text, data) {\r\n    const arr = Array.from(this._selectElement.querySelectorAll(\"option\"));\r\n    const opts = data.value ? arr.filter((el) => el.value == data.value) : arr.filter((el) => el.textContent == text);\r\n    // Only consider actual <option> in the select\r\n    if (opts.length > 0) {\r\n      const freeOpt = opts.find((opt) => !opt.getAttribute(\"selected\"));\r\n      if (!freeOpt) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Find if label is selectable (based on attribute)\r\n   * @param {string} text\r\n   * @returns {Boolean}\r\n   */\r\n  hasItem(text) {\r\n    for (let item of this._config.items) {\r\n      const items = item[\"items\"] || [item];\r\n      for (let si of items) {\r\n        if (si[this._config.labelField] == text) return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * @param {string} value\r\n   * @returns {Object|null}\r\n   */\r\n  getItem(value) {\r\n    for (let item of this._config.items) {\r\n      const items = item[\"items\"] || [item];\r\n      for (let si of items) {\r\n        if (si[this._config.valueField] == value) return si;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Checks if value matches a configured regex\r\n   * @param {string} value\r\n   * @returns {Boolean}\r\n   */\r\n  _validateRegex(value) {\r\n    const regex = new RegExp(this._config.regex.trim());\r\n    return regex.test(value);\r\n  }\r\n\r\n  /**\r\n   * @returns {HTMLElement}\r\n   */\r\n  getSelection() {\r\n    return this._dropElement.querySelector(\"a.\" + ACTIVE_CLASS);\r\n  }\r\n\r\n  removeSelection() {\r\n    const selection = this.getSelection();\r\n    if (selection) {\r\n      selection.classList.remove(...this._activeClasses());\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @returns {Array}\r\n   */\r\n  _activeClasses() {\r\n    return [...this._config.activeClasses, ...[ACTIVE_CLASS]];\r\n  }\r\n\r\n  /**\r\n   * @deprecated since 1.5\r\n   * @returns {HTMLElement}\r\n   */\r\n  getActiveSelection() {\r\n    return this.getSelection();\r\n  }\r\n\r\n  /**\r\n   * @deprecated since 1.5\r\n   */\r\n  removeActiveSelection() {\r\n    return this.removeSelection();\r\n  }\r\n\r\n  /**\r\n   * Remove all items\r\n   */\r\n  removeAll() {\r\n    let items = this.getSelectedValues();\r\n    items.forEach((item) => {\r\n      this.removeItem(item, true);\r\n    });\r\n    this._adjustWidth();\r\n  }\r\n\r\n  /**\r\n   * @param {Boolean} noEvents\r\n   */\r\n  removeLastItem(noEvents = false) {\r\n    let lastItem = this.getLastItem();\r\n    if (lastItem) {\r\n      this.removeItem(lastItem, noEvents);\r\n    }\r\n  }\r\n\r\n  getLastItem() {\r\n    let items = this._containerElement.querySelectorAll(\"span.\" + CLASS_PREFIX + \"badge\");\r\n    if (!items.length) {\r\n      return;\r\n    }\r\n    let lastItem = items[items.length - 1];\r\n    return lastItem.getAttribute(VALUE_ATTRIBUTE);\r\n  }\r\n\r\n  enable() {\r\n    this._selectElement.setAttribute(\"disabled\", \"\");\r\n    this.resetState();\r\n  }\r\n\r\n  disable() {\r\n    rmAttr(this._selectElement, \"disabled\");\r\n    this.resetState();\r\n  }\r\n\r\n  /**\r\n   * @returns {Boolean}\r\n   */\r\n  isDisabled() {\r\n    return this._selectElement.hasAttribute(\"disabled\") || this._selectElement.disabled || this._selectElement.hasAttribute(\"readonly\");\r\n  }\r\n\r\n  /**\r\n   * @returns {Boolean}\r\n   */\r\n  isDropdownVisible() {\r\n    return this._dropElement.classList.contains(SHOW_CLASS);\r\n  }\r\n\r\n  /**\r\n   * @returns {Boolean}\r\n   */\r\n  isInvalid() {\r\n    return this._holderElement.classList.contains(INVALID_CLASS);\r\n  }\r\n\r\n  /**\r\n   * @returns {Boolean}\r\n   */\r\n  isSingle() {\r\n    return !this._selectElement.hasAttribute(\"multiple\");\r\n  }\r\n\r\n  /**\r\n   * @returns {Boolean}\r\n   */\r\n  isMaxReached() {\r\n    return this._config.max && this.getSelectedValues().length >= this._config.max;\r\n  }\r\n\r\n  /**\r\n   * @param {string} text\r\n   * @param {Object} data\r\n   * @returns {Boolean}\r\n   */\r\n  canAdd(text, data = {}) {\r\n    // Check invalid input\r\n    if (!text) {\r\n      return false;\r\n    }\r\n    // Doesn't allow new\r\n    if (data.new && !this._config.allowNew) {\r\n      return false;\r\n    }\r\n    // This item doesn't exist\r\n    if (!data.new && !this.hasItem(text)) {\r\n      return false;\r\n    }\r\n    // Check disabled\r\n    if (this.isDisabled()) {\r\n      return false;\r\n    }\r\n    // Check already selected input (single will replace, so never return false if selected)\r\n    if (!this.isSingle() && !this._config.allowSame) {\r\n      // Check if value is selected\r\n      if (data.new) {\r\n        if (this._isSelected(text)) {\r\n          return false;\r\n        }\r\n      } else {\r\n        if (!this._isSelectable(text, data)) {\r\n          return false;\r\n        }\r\n      }\r\n    }\r\n    // Check for max\r\n    if (this.isMaxReached()) {\r\n      return false;\r\n    }\r\n    // Check for regex on new input\r\n    if (this._config.regex && data.new && !this._validateRegex(text)) {\r\n      this._holderElement.classList.add(INVALID_CLASS);\r\n      return false;\r\n    }\r\n    // Check for custom validation\r\n    if (this._config.onCanAdd && this._config.onCanAdd(text, data, this) === false) {\r\n      this._holderElement.classList.add(INVALID_CLASS);\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  getData() {\r\n    return this._config.items;\r\n  }\r\n\r\n  /**\r\n   * Set data\r\n   * @param {Array<Suggestion|SuggestionGroup>|Object} src An array of items or a value:label object\r\n   * @param {Boolean} init called during init\r\n   */\r\n  setData(src, init = false) {\r\n    // Convert value:label to array\r\n    if (!Array.isArray(src)) {\r\n      src = Object.entries(src).map(([value, label]) => ({ value, label }));\r\n    }\r\n\r\n    // If not passed in config\r\n    if (this._config.items != src) {\r\n      this._config.items = src;\r\n    }\r\n\r\n    // Track initial selection in case of reset\r\n    if (init) {\r\n      // addItem will add attribute back\r\n      this._removeSelectedAttrs();\r\n      const flatSrc = src.reduce((a, b) => {\r\n        return a.concat(b.group ? b.items : [b]);\r\n      }, []);\r\n      flatSrc.forEach((suggestion) => {\r\n        const value = suggestion[this._config.valueField];\r\n        const label = suggestion[this._config.labelField];\r\n\r\n        if (!value) {\r\n          return;\r\n        }\r\n\r\n        // Selection on item only matters on init\r\n        if (suggestion.selected || this._config.selected.includes(value)) {\r\n          const added = this.addItem(label, value, suggestion.data);\r\n          // Add attribute to actual option to allow for same options being selected\r\n          if (added) {\r\n            added.setAttribute(\"data-init\", \"true\");\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    this._buildSuggestions(src);\r\n    this._resetHtmlState();\r\n  }\r\n\r\n  /**\r\n   * Keep in mind that we can have the same value for multiple options\r\n   * @param {*} value\r\n   * @param {string} mode\r\n   * @param {number} counter\r\n   * @returns {HTMLOptionElement|null}\r\n   */\r\n  _findOption(value = null, mode = \"\", counter = 0) {\r\n    // escape invalid characters for HTML attributes: \\' \" = < > ` &.'\r\n    const val = value === null ? \"\" : '[value=\"' + CSS.escape(value) + '\"]';\r\n    const sel = \"option\" + val + mode;\r\n    const opts = this._selectElement.querySelectorAll(sel);\r\n    //@ts-ignore\r\n    return opts[counter] || null;\r\n  }\r\n\r\n  /**\r\n   * Add item by value\r\n   * @param {string} value\r\n   * @param {object} data\r\n   * @return {HTMLOptionElement|null} The selected option or null\r\n   */\r\n  setItem(value, data = {}) {\r\n    let addedItem = null;\r\n    let opt = this._findOption(value, \":not([selected])\");\r\n    if (opt) {\r\n      addedItem = this.addItem(opt.textContent, opt.value, data);\r\n    }\r\n    // Look also in items\r\n    let item = this.getItem(value);\r\n    if (item) {\r\n      const value = item[this._config.valueField];\r\n      const label = item[this._config.labelField];\r\n      addedItem = this.addItem(label, value, data);\r\n    }\r\n    // Maybe we need to whole _resetHtmlState thing\r\n    this._adjustWidth();\r\n    this._checkMax();\r\n    return addedItem;\r\n  }\r\n\r\n  /**\r\n   * You might want to use canAdd before to ensure the item is valid\r\n   * @param {string} text\r\n   * @param {string} value\r\n   * @param {object} data\r\n   * @return {HTMLOptionElement} The created or selected option\r\n   */\r\n  addItem(text, value = null, data = {}) {\r\n    // No value provided\r\n    if (!value) {\r\n      value = text;\r\n    }\r\n\r\n    // Single items remove first\r\n    if (this.isSingle() && this.getSelectedValues().length) {\r\n      this.removeLastItem(true);\r\n    }\r\n\r\n    let opt = this._findOption(value, \":not([selected])\");\r\n\r\n    // we need to create a new option\r\n    if (!opt) {\r\n      opt = ce(\"option\");\r\n      opt.value = value;\r\n      opt.innerText = text;\r\n      // Pass along data provided\r\n      for (const [key, value] of Object.entries(data)) {\r\n        opt.dataset[key] = value;\r\n      }\r\n      this._selectElement.appendChild(opt);\r\n      this._config.onCreateItem(opt, this);\r\n    }\r\n\r\n    if (opt) {\r\n      data = Object.assign(\r\n        {\r\n          title: opt.getAttribute(\"title\"),\r\n        },\r\n        data,\r\n        opt.dataset\r\n      );\r\n    }\r\n    // update select, we need to set attribute for option[selected]\r\n    opt.setAttribute(\"selected\", \"selected\");\r\n    opt.selected = true;\r\n\r\n    this._createBadge(text, value, data);\r\n\r\n    // Fire change event\r\n    if (this._fireEvents) {\r\n      this._selectElement.dispatchEvent(new Event(\"change\", { bubbles: true }));\r\n    }\r\n\r\n    return opt;\r\n  }\r\n\r\n  /**\r\n   * mobile safari is doing it's own crazy thing...\r\n   * without this, it wil not pick up the proper state of the select element and validation will fail\r\n   */\r\n  _resetHtmlState() {\r\n    const html = this._selectElement.innerHTML;\r\n    this._selectElement.innerHTML = \"\";\r\n    this._selectElement.innerHTML = html;\r\n\r\n    this._adjustWidth();\r\n  }\r\n\r\n  /**\r\n   * @param {string} text\r\n   * @param {string} value\r\n   * @param {object} data\r\n   */\r\n  _createBadge(text, value = null, data = {}) {\r\n    const v5 = this._getBootstrapVersion() === 5;\r\n    const disabled = data.disabled && parseBool(data.disabled);\r\n    const allowClear = this._config.allowClear && !disabled;\r\n\r\n    // create span\r\n    let html = this._config.allowHtml ? text : this._config.sanitizer(text);\r\n\r\n    /**\r\n     * @type {HTMLSpanElement}\r\n     */\r\n    let span = ce(\"span\");\r\n    let classes = [CLASS_PREFIX + \"badge\"];\r\n\r\n    const isSingle = this.isSingle() && !this._config.singleBadge;\r\n\r\n    if (!isSingle) {\r\n      classes.push(\"badge\");\r\n      let badgeStyle = this._config.badgeStyle;\r\n      if (data.badgeStyle) {\r\n        badgeStyle = data.badgeStyle;\r\n      }\r\n      if (data.badgeClass) {\r\n        classes.push(...data.badgeClass.split(\" \"));\r\n      }\r\n      if (this._config.baseClass) {\r\n        // custom style\r\n        classes.push(...this._config.baseClass.split(\" \"));\r\n      } else if (v5) {\r\n        // https://getbootstrap.com/docs/5.3/components/badge/\r\n        classes = [...classes, ...[\"bg-\" + badgeStyle], \"text-truncate\"];\r\n      } else {\r\n        // https://getbootstrap.com/docs/4.6/components/badge/\r\n        classes = [...classes, ...[\"badge-\" + badgeStyle]];\r\n      }\r\n\r\n      // add extra styles to avoid any layout issues due to very large labels\r\n      span.style.maxWidth = \"100%\";\r\n    }\r\n\r\n    if (disabled) {\r\n      classes.push(...[\"disabled\", \"opacity-50\"]);\r\n    }\r\n\r\n    const vertMargin = isSingle ? 0 : 2;\r\n\r\n    // We cannot really rely on classes to get a proper sizing\r\n    span.style.margin = vertMargin + \"px 6px \" + vertMargin + \"px 0px\";\r\n    // Use logical styles for RTL support\r\n    span.style.marginBlock = vertMargin + \"px\";\r\n    span.style.marginInline = \"0px 6px\";\r\n    // Required for some older browsers that don't inherit properly of holder flex styles\r\n    span.style.display = \"flex\";\r\n    span.style.alignItems = \"center\";\r\n    span.classList.add(...classes);\r\n    span.setAttribute(VALUE_ATTRIBUTE, value);\r\n    // Tooltips\r\n    if (data.title) {\r\n      span.setAttribute(\"title\", data.title);\r\n    }\r\n\r\n    if (allowClear) {\r\n      // NOTE: we cannot use flex and align-item center because it disables text truncation\r\n      // TODO: btn-close white is deprecated\r\n      // @link https://getbootstrap.com/docs/5.3/components/close-button/\r\n      const closeClass = classes.includes(\"text-dark\") || isSingle ? \"btn-close\" : \"btn-close btn-close-white\";\r\n      let btnMargin = \"margin-inline: 0px 6px;\";\r\n      let pos = \"left\";\r\n      if (this._config.clearEnd) {\r\n        pos = \"right\";\r\n      }\r\n      if (pos == \"right\") {\r\n        btnMargin = \"margin-inline: 6px 0px;\";\r\n      }\r\n      const btn = v5\r\n        ? '<button type=\"button\" style=\"font-size:0.65em;' +\r\n          btnMargin +\r\n          '\" class=\"' +\r\n          closeClass +\r\n          '\" aria-label=\"' +\r\n          this._config.clearLabel +\r\n          '\"></button>'\r\n        : '<button type=\"button\" style=\"font-size:1em;' +\r\n          btnMargin +\r\n          'text-shadow:none;color:currentColor;transform:scale(1.2);float:none\" class=\"close\" aria-label=\"' +\r\n          this._config.clearLabel +\r\n          '\"><span aria-hidden=\"true\">&times;</span></button>';\r\n\r\n      // rtl will follow logical html order\r\n      html = pos == \"left\" ? btn + html : html + btn;\r\n    }\r\n\r\n    span.innerHTML = html;\r\n    this._containerElement.insertBefore(span, this._searchInput);\r\n\r\n    // tooltips\r\n    if (data.title && tooltip && v5) {\r\n      tooltip.getOrCreateInstance(span);\r\n    }\r\n\r\n    if (allowClear) {\r\n      span.querySelector(\"button\").addEventListener(\"click\", (event) => {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        if (!this.isDisabled()) {\r\n          this._config\r\n            .confirmClear(value, this)\r\n            .then(() => {\r\n              this.removeItem(value);\r\n              //@ts-ignore\r\n              document.activeElement.blur();\r\n              this._adjustWidth();\r\n            })\r\n            .catch(() => {});\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @returns {HTMLDivElement}\r\n   */\r\n  getHolder() {\r\n    return this._holderElement;\r\n  }\r\n\r\n  clear() {\r\n    this.hideSuggestions();\r\n    this.reset();\r\n  }\r\n\r\n  /**\r\n   * Update data\r\n   * @param {Array<Suggestion|SuggestionGroup>|Object} src An array of items or a value:label object\r\n   */\r\n  updateData(src) {\r\n    this.setData(src, false);\r\n    this.reset();\r\n  }\r\n\r\n  /**\r\n   * @param {string} value\r\n   * @param {Boolean} value\r\n   */\r\n  removeItem(value, noEvents = false) {\r\n    // Remove badge if any\r\n    // escape invalid characters for HTML attributes: \\' \" = < > ` &.'\r\n    const escapedValue = CSS.escape(value);\r\n    let items = this._containerElement.querySelectorAll(\"span[\" + VALUE_ATTRIBUTE + '=\"' + escapedValue + '\"]');\r\n    if (!items.length) {\r\n      return;\r\n    }\r\n    // Remove the last entry for this value\r\n    const idx = items.length - 1;\r\n    const item = items[idx];\r\n    if (item) {\r\n      if (item.dataset.bsOriginalTitle) {\r\n        tooltip.getOrCreateInstance(item).dispose();\r\n      }\r\n      item.remove();\r\n    }\r\n\r\n    // update select\r\n    let opt = this._findOption(value, \"[selected]\", idx);\r\n    if (opt) {\r\n      rmAttr(opt, \"selected\");\r\n      opt.selected = false;\r\n\r\n      // Fire change event\r\n      if (this._fireEvents && !noEvents) {\r\n        this._selectElement.dispatchEvent(new Event(\"change\", { bubbles: true }));\r\n      }\r\n    }\r\n\r\n    // Make input visible\r\n    if (this._searchInput.style.visibility == \"hidden\" && !this.isMaxReached()) {\r\n      this._searchInput.style.visibility = \"visible\";\r\n      this._holderElement.classList.remove(MAX_REACHED_CLASS);\r\n    }\r\n\r\n    if (!noEvents) {\r\n      this._config.onClearItem(value, this);\r\n    }\r\n  }\r\n}\r\n\r\nexport default Tags;\r\n"],
  "mappings": "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",
  "names": ["DEFAULTS", "str", "sanitize", "item", "label", "inst", "value", "option", "event", "text", "data", "response", "e", "signal", "CLASS_PREFIX", "LOADING_CLASS", "ACTIVE_CLASS", "INVALID_CLASS", "MAX_REACHED_CLASS", "SHOW_CLASS", "VALUE_ATTRIBUTE", "NEXT", "PREV", "FOCUS_CLASS", "PLACEHOLDER_CLASS", "DISABLED_CLASS", "INSTANCE_MAP", "counter", "tooltip", "debounce", "func", "timeout", "timer", "args", "calcTextWidth", "size", "span", "ce", "width", "r", "removeDiacritics", "normalize", "fuzzyMatch", "lookup", "pos", "c", "hideItem", "attrs", "showItem", "el", "k", "v", "rmAttr", "attr", "parseBool", "tagName", "splitMulti", "tokens", "tempChar", "nested", "obj", "p", "Tags", "config", "_selectElement", "_configure", "_isMouse", "_keyboardNavigation", "_searchFunc", "_loadFromServer", "_config", "_fireEvents", "_configureParent", "_holderElement", "_containerElement", "_dropElement", "_searchInput", "_configureHolderElement", "_configureContainerElement", "_configureSelectElement", "_configureSearchInput", "_configureDropElement", "ev", "_handleEvent", "type", "selector", "opts", "reset", "list", "i", "_timer", "_findOption", "json", "o", "key", "defaultValue", "_getPlaceholder", "firstOption", "selectEl", "dropEl", "dropStyles", "holder", "className", "containerStyles", "searchInput", "_rtl", "related", "_abortController", "clearValidation", "_enterValue", "sel", "splitData", "n", "_addPastedValue", "addData", "_add", "lastChar", "_adjustWidth", "target", "_moveSelection", "lastItem", "_positionMenu", "init", "_setSelectedAttributes", "selectedOptions", "j", "convertOption", "suggestions", "selection", "show", "extraParams", "params", "input", "inputName", "urlParams", "url", "fetchOptions", "_showSuggestions", "_resetHtmlState", "_isItemEnabled", "li", "fc", "dir", "active", "sibling", "_activeClasses", "selHeight", "selTop", "parent", "parentHeight", "parentScrollHeight", "parentTop", "scrollTop", "a", "computedFontSize", "w", "_buildSuggestions", "idx", "groupId", "suggestion", "newChild", "newChildSpan", "groupSuggestion", "_buildSuggestionsItem", "notFound", "textContent", "newChildLink", "searchData", "sf", "v5", "_getBootstrapVersion", "_removeSelectedAttrs", "opt", "iv", "_checkMax", "_shouldShow", "selected", "check", "valueCounter", "count", "firstItem", "hasPossibleValues", "visibleGroups", "link", "showAllSuggestions", "isMatched", "found", "selectFirst", "highlighted", "notFoundMessage", "_showDropdown", "isVisible", "wasVisible", "isRTL", "fixed", "fullWidth", "bounds", "holderBounds", "left", "top", "hdiff", "dropBounds", "h", "topOffset", "ver", "jq", "_isSelected", "_isSelectable", "arr", "items", "si", "_validateRegex", "noEvents", "src", "b", "added", "mode", "addedItem", "_createBadge", "html", "disabled", "allowClear", "classes", "isSingle", "badgeStyle", "vertMargin", "closeClass", "btnMargin", "btn", "escapedValue", "tags_default"]
}
